!function(e,i){"use strict";Genki.appendix={jisho:{mode:"ja",selected:[],init:function(){for(var t,n,o=i.querySelectorAll(".definition"),l=0,a=o.length,r=e.localStorage&&localStorage.selectedDefinitions?localStorage.selectedDefinitions.split(","):[],s=[],c={},d=0;l<a;l++)n=o[l].querySelector(".def-en"),/.*?-\d+/.test(o[l].dataset.def)&&n.innerHTML?(o[l].insertAdjacentHTML("afterbegin",'<input class="def-selector genki_input_hidden" type="checkbox" onchange="Genki.appendix.jisho.updateCheckboxes(this, \''+o[l].dataset.def+"');\""+(-1!=r.indexOf(o[l].dataset.def)?"checked":"")+'><span class="genki_pseudo_checkbox" onclick="this.previousSibling.click(); return false;"/>'),c[t=n.innerHTML.replace(/^\(.*?\) |^to |^the |^it |^\.\.\.(?:,|)/gi,"").toLowerCase()]&&(t=t+"-"+ ++d),c[t]=o[l].cloneNode(!0),s.push(t)):o[l].innerHTML="<em>Coming soon...</em>";for(l=0,a=(s=s.sort()).length;l<a;l++)(n=c[s[l]].innerHTML.match(/<span class="def-en">(.*?)<\/span>/))[0]&&(c[s[l]].innerHTML=c[s[l]].innerHTML.replace(/<span class="def-en">.*?<\/span>/,"").replace(/(<input.*?<\/span>)/,"$1"+n[0]+" "),i.getElementById("list-"+s[l].charAt(0).toUpperCase()).appendChild(c[s[l]]));Genki.appendix.jisho.restoreSettings(),AddJumpArrowsTo(".dictionary-group .section-title","dictionary-top","Return to the top of the dictionary"),Genki.appendix.finishedLoading()},switchMode:function(t){var n={button:i.getElementById("ja-mode"),dict:i.getElementById("japanese-english")},o={button:i.getElementById("en-mode"),dict:i.getElementById("english-japanese")};"ja"==t&&"ja"!=Genki.appendix.jisho.mode?(n.button.className+=" active-mode",o.button.className=o.button.className.replace(" active-mode",""),n.dict.style.display="",o.dict.style.display="none"):"en"==t&&"en"!=Genki.appendix.jisho.mode&&(o.button.className+=" active-mode",n.button.className=n.button.className.replace(" active-mode",""),o.dict.style.display="",n.dict.style.display="none"),e.localStorage&&(Genki.appendix.jisho.mode=t,localStorage.genkiJishoMode=t)},updateCheckboxes:function(t,n,o){var l=i.querySelectorAll('[data-def="'+n+'"] .def-selector'),a=Genki.appendix.jisho.selected.indexOf(n),r=0,s=l.length;if(t.checked){for(;r<s;r++)t!=l[r]&&(l[r].checked=!0);-1==a&&Genki.appendix.jisho.selected.push(n)}else if(!t.checked){for(;r<s;r++)t!=l[r]&&(l[r].checked=!1);-1!=a&&Genki.appendix.jisho.selected.splice(a,1)}!o&&e.localStorage&&(localStorage.selectedDefinitions=Genki.appendix.jisho.selected)},selectAll:function(t,n,o){for(var l=i.querySelectorAll(o?n:("ja"==Genki.appendix.jisho.mode?"#japanese-english":"#english-japanese")+(n?" #"+n:"")+" .def-selector"),a=0,r=l.length;a<r;a++)l[a].checked=t,Genki.appendix.jisho.updateCheckboxes(l[a],l[a].parentNode.dataset.def,!0);e.localStorage&&(localStorage.selectedDefinitions=Genki.appendix.jisho.selected)},search:function(e,t){var n=i.createDocumentFragment(),o=i.getElementById("dict-search-results-"+t),l=i.getElementById("dict-search-hits-"+t),a=i.querySelectorAll(("ja"==t?"#japanese-english":"#english-japanese")+" .dictionary-group .definition"),r=a.length,s=0,c=0;if(o.innerHTML="",e)for(;c<r;c++)/.*?-\d+/.test(a[c].dataset.def)&&-1!=a[c].innerText.toLowerCase().indexOf(e.toLowerCase())&&(n.appendChild(a[c].cloneNode(!0)),s++);n.childNodes.length?(o.parentNode.querySelector(".group-selectors").style.visibility="",o.appendChild(n)):(o.parentNode.querySelector(".group-selectors").style.visibility="hidden",o.innerHTML=e?'<li>No results found for "'+e+'".</li>':""),l.innerHTML=s?"("+s+") ":""},launchExercise:function(){var t=Genki.appendix.jisho.selected.length;t<5?GenkiModal.open({title:"Please select more words.",content:"Please select <b>"+(5-t)+"</b> more word"+(5-t==1?"":"s")+" to begin a practice exercise."}):GenkiModal.open({title:"Begin Practice?",content:'Are you ready to practice your selected words? Please select the type of exercise you would like to practice with below.<div class="center"><select id="dict-exercise-type"><option value="multi"'+(e.localStorage&&"multi"==localStorage.genkiJishoExercise?" selected":"")+'>Multiple Choice</option><option value="drag"'+(e.localStorage&&"drag"==localStorage.genkiJishoExercise?" selected":"")+'>Drag and Drop</option><option value="writing"'+(e.localStorage&&"writing"==localStorage.genkiJishoExercise?" selected":"")+'>Spelling Practice</option><option value="fill"'+(e.localStorage&&"fill"==localStorage.genkiJishoExercise?" selected":"")+">Write the Definition</option></select></div>",callback:function(){var n,o,l,a,r,s,c,d,p=i.getElementById("dict-exercise-type").value,g=Genki.appendix.jisho.selected,h=0;if(e.localStorage&&(localStorage.genkiJishoExercise=p),i.getElementById("appendix-tool").style.display="none",i.getElementById("exercise").style.display="","drag"==p){for(d={};h<t;h++)c=(s=i.querySelector('#japanese-english [data-def="'+g[h]+'"]')).querySelector(".def-furi i"),d[s.querySelector(".def-ja").innerHTML.replace(/<i>.*?<\/i>/,"")+(c?"|"+c.innerHTML:"")]=s.querySelector(".def-en").innerHTML;Genki.generateQuiz({type:p,info:Genki.lang.std_drag,quizlet:d})}else if("multi"==p){for(d=[];h<t;h++)for(c=(s=i.querySelector('#japanese-english [data-def="'+g[h]+'"]')).querySelector(".def-furi i"),r=s.querySelector(".def-en").innerHTML,d[h]={question:s.querySelector(".def-ja").innerHTML.replace(/<i>.*?<\/i>/,"")+(c?'<div class="furigana">'+c.innerHTML+"</div>":""),answers:["A"+r]},(l=g.slice()).splice(h,1),o=3;o-- >0&&l.length;)n=Math.floor(Math.random()*l.length),(a=i.querySelector('#japanese-english [data-def="'+l[n]+'"] .def-en').innerHTML)==r?o++:d[h].answers.push("A"==a.charAt(0)?"!"+a:a),l.splice(n,1);Genki.generateQuiz({type:p,info:"Choose the correct definition for each word.",quizlet:d})}else if("writing"==p){for(d={};h<t;h++)c=(s=i.querySelector('#japanese-english [data-def="'+g[h]+'"]')).querySelector(".def-furi i"),d[s.querySelector(".def-ja").innerHTML.replace(/<i>.*?<\/i>/,"")]=c?c.innerHTML:"";Genki.generateQuiz({type:p,info:"Practice spelling the following words.",columns:6,quizlet:d})}else if("fill"==p){for(d='<div class="count-problems columns-2 clear"><div>',n=Math.ceil(t/2);h<t;h++)c=(s=i.querySelector('#japanese-english [data-def="'+g[h]+'"]')).querySelector(".def-furi i"),d+=(h==n?"</div><div>":"")+'<div class="problem">'+s.querySelector(".def-en").innerHTML+"<br>"+("{"+s.querySelector(".def-ja").innerHTML.replace(/<i>.*?<\/i>/,"")+(c?"|"+c.innerHTML+"|answer":"")+"}").replace(/（(.*?)）/g,"%($1/)")+"</div>";Genki.generateQuiz({type:p,info:"Write the Japanese definition for the following words.",quizlet:d+"</div></div>"})}}})},restoreSettings:function(){e.localStorage&&(localStorage.genkiJishoMode&&"ja"!=localStorage.genkiJishoMode&&Genki.appendix.jisho.switchMode(localStorage.genkiJishoMode),localStorage.selectedDefinitions&&(Genki.appendix.jisho.selected=localStorage.selectedDefinitions.split(",")))}},finishedLoading:function(){var e=i.querySelector(".loading");e.className=e.className.replace("loading","")}},i.getElementById("appendix-tool").appendChild(i.querySelector(".more-exercises").cloneNode(!0))}(window,document);