!function(e,t){"use strict";var i={stats:{problems:0,solved:0,mistakes:0,score:0,exclude:0},canNotify:"Notification"in e,isTouch:"ontouchstart"in e||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,isTouching:!1,textSelectMode:!1,strokeNumberDisplay:!1,markedItem:null,ed:"lessons"+(/lessons-3rd/.test(e.location.pathname)?"-3rd":""),local:"file:"==e.location.protocol?"index.html":"",debug:/\?debug/.test(e.location.search)?"?debug":"",lang:{std_drag:"Drag the English expression to the Japanese expression that has the same meaning.<br>TIP: Click an expression to mark it, then click an empty field to drop the answer there.",std_kana:"Drag the Kana to the matching Romaji.<br>TIP: Click the kana to mark it, then click an empty field to drop the answer there.",std_num:"Drag the Numbers to the matching Kana.<br>TIP: Click a number to mark it, then click an empty field to drop the answer there.",std_multi:"Solve the problems by choosing the correct answers.",std_questions:"Answer the questions as best as you can.",std_culture:"Answer the questions about Japanese culture as best as you can.",std_stroke_order:"Practice drawing each kanji by following the stroke order.",std_drawing:"Practice drawing the following kanji multiple times.",vocab_multi:"Choose the correct definition for each Japanese expression.",vocab_writing:"Practice spelling the following words/expressions.",vocab_fill:"Write the Japanese definition for the following words/expressions.",kana_multi:"Choose the correct Romaji for the %{KANA}.",kana_writing:"Practice writing the following %{KANA}.",kana_fill:"Complete the chart by filling in the Romaji.",num_multi:"Read the Japanese and choose the correct numbers.",num_writing:"Practice spelling the following numbers.",num_fill:"Write the following numbers in Japanese (hiragana).",kanji_readings_multi:"Choose the correct readings for each kanji.",kanji_readings_drag:"Match each kanji with their readings.",kanji_meanings_multi:"Choose the correct meanings for each kanji.",kanji_meanings_drag:"Match each kanji with their meanings.",opts:{kana:{kana:"Drag and Drop",multi:"Multiple Choice",writing:"Writing Practice",fill:"Fill in the Chart"},numbers:{drag:"Drag and Drop",multi:"Multiple Choice",writing:"Spelling Practice",fill:"Write the Numbers"},kanji:{multi:"Multiple Choice",drag:"Drag and Drop"},vocab:{drag:"Drag and Drop",multi:"Multiple Choice",writing:"Spelling Practice",fill:"Write the Definition"},practice:{multi:"Multiple Choice",fill:"Written",drag:"Drag and Drop"}},mistakes:'The items outlined in <span class="t-red t-bold">red</span> were answered wrong before finding the correct answer. Review these problems before trying again.',writing_mistakes:'The items outlined in <span class="t-red t-bold">red</span> were answered wrong. Review these problems before trying again.',multi_mistakes:'The answers you selected that were wrong are outlined in <span class="t-red t-bold">red</span>. The correct answers are outlined in <span class="t-blue t-bold">blue</span>. Review these problems before trying again.',stroke_mistakes:'The kanji you drew that were wrong are outlined in <span class="t-red t-bold">red</span>. Please review the stroke order and number of strokes for these kanji before trying again.<br><br><b>Note:</b> Sometimes answers may be marked wrong by mistake, due to a mismatch in the recognition algorithm.<br>Please use your own discretion if this occurs.',drawing_mistakes:'The kanji you drew that were wrong are outlined in <span class="t-red t-bold">red</span>. Please review the stroke order and number of strokes for these kanji before trying again.<br><br><b>Note:</b> Sometimes answers may be marked wrong by mistake, due to a mismatch in the recognition algorithm.<br>Please use your own discretion if this occurs.',fill_mistakes:'The items underlined in <span class="t-red t-bold">red</span> were answered wrong, the correct answers are listed underneath in <span class="t-green t-bold">green</span>. Review these problems before trying again.',sub_answers:'<b>Note:</b> Answers inside <span class="t-blue t-bold">blue</span> parentheses separated by "<span class="alt-phrase-sep">/</span>" are a list of possible sub-answers; only one can be used.<br>For example.. <span class="t-green"><span class="alt-phrase">(</span>あの<span class="alt-phrase-sep">/</span>その<span class="alt-phrase">)</span>ねこ</span>: そのねこ or あのねこ <span class="t-green">(good)</span> vs あの/そのねこ <span class="t-red">(bad)</span><br><span class="t-green"><span class="alt-phrase">(</span>この<span class="alt-phrase-sep">/</span><span class="alt-phrase">)</span>ねこ</span> means the sub-answer is optional; it can be left out.',review:'<div id="review-exercise" class="center clearfix"><button id="review-button" class="button" onclick="Genki.review();"><i class="fa">&#xf02d;</i>Review</button></div>',toggle_furigana:'<button class="button" onclick="Genki.toggle.furigana(this);"><i class="fa">&#xf2a8;</i>'+(storageOK&&"false"==localStorage.furiganaVisible?"Show":"Hide")+" Furigana</button>",check_answers:'<div id="check-answers" class="center"><button class="button" onclick="Genki.check.answers();"><i class="fa">&#xf00c;</i>Check Answers</button></div>',back_to_dict:'<button class="button" onclick="Genki.appendix.jisho.reset();"><i class="fa">&#xf021;</i>Back to Dictionary</button>'},active:{exercise:null,index:0,path:e.location.pathname.replace(/.*?\/lessons.*?\/(.*?\/.*?)\/.*/g,"$1")},exercises:GenkiExercises,scrollTo:function(e,i){"string"==typeof e&&(e=t.querySelector(e));var s=function(){t.body.scrollTop=e.offsetTop,t.documentElement.scrollTop=e.offsetTop};i?setTimeout(s,100):s()},generateQuiz:function(s){var a=t.getElementById("quiz-zone");if("object"==typeof s.type){for(var n,r=!!/begin=\d/.test(e.location.search)&&e.location.search.replace(/.*?begin=(\d).*/,"$1"),o=0,l=s.type.length,c="";o<l;o++)c+='<option value="'+o+'"'+(!1!==r?o==r?" selected":"":storageOK&&localStorage["genki_pref_"+s.format]==s.type[o]?" selected":"")+">"+i.lang.opts[s.format][s.type[o]]+"</option>";return n=GenkiModal.open({title:"Please Select an Exercise Type",content:'Please select the type of exercise you would like to do, then click "Begin" to start studying.<br><br><div class="center"><div><b>Current Exercise</b><br>'+t.title.replace(/ \| Genki Study Resources.*$/,"")+'</div><br><div><b>Exercise Type</b><br><select id="exercise-type">'+c+"</select></div></div>",buttonText:"Begin",noClose:1,zIndex:"low",callback:function(){var e=t.getElementById("exercise-type").value;if(s.type=s.type[e],s.info="object"==typeof s.info&&s.info[e]?s.info[e]:s.info,storageOK&&(localStorage["genki_pref_"+s.format]=s.type),/vocab|kana|numbers|kanji/.test(s.format)){if("kana"==s.format&&"kana"!=s.type){var a={};for(w in s.quizlet)for(l in s.quizlet[w])a[l]=s.quizlet[w][l];s.quizlet=a,s.info=s.info.replace("%{KANA}",i.active.exercise[1].replace(/.*?(Hiragana|Katakana).*/,"$1"))}if("kanji"==s.format&&s.readings){for(w in s.quizlet)s.quizlet[w]=s.quizlet[w].replace(/(On\:|Kun\:)/g,"<b>$1</b>");"drag"==s.type&&(t.getElementById("exercise").className+=" kanji-readings")}if("multi"==s.type){var n,r,o,l,c,d=[],u=[],g=[];for(w in s.quizlet)u.push(w),g.push(w);for(w=0,y=u.length;w<y;w++){for(v=u[q=Math.floor(Math.random()*u.length)].split("|"),n=s.quizlet[u[q]],d.push({question:("kanji"==s.format?'<div class="big-kanji">':"")+v[0]+("kanji"==s.format?"</div>":"")+(v[1]?'<div class="furigana">'+v[1]+"</div>":""),answers:["A"+n]}),(o=g.slice()).splice(q,1),l=3;l-- >0&&o.length;)c=Math.floor(Math.random()*o.length),(r=s.quizlet[o[c]])==n?l++:d[w].answers.push("A"==r.charAt(0)?"!"+r:r),o.splice(c,1);u.splice(q,1)}s.quizlet=d}else if("writing"==s.type){var h;d={};for(w in s.quizlet)for(var p,m=(h=w.split("|"))[0].split("／"),k=0,f=m.length;k<f;k++)p=h[1]?h[1]:"kana"==s.format?s.quizlet[w]:"",d[m[k].replace(/\(.*?\)|（.*?）|。|～/g,"")]=p,/\(.*?\)|（.*?）/.test(m[k])&&(d[m[k].replace(/。|～|\(|\)|（|）/g,"")]=p);s.quizlet=d,s.columns=6}else if("fill"==s.type)if(/vocab|numbers/.test(s.format)){d='<div class="count-problems columns-2 clear"><div>';var v,b,w,y,q,x=/。|～/g;u=[];for(w in s.quizlet)u.push(w);for(w=0,y=u.length,q=Math.ceil(y/2);w<y;w++)b=("{"+(v=u[w].split("|"))[0].replace(x,"")+(x.test(v[0])?"|"+v[0]:"")+(v[1]?"|"+v[1].replace(x,"")+(x.test(v[1])?"|"+v[1]:""):"")+"}").replace(/\((.*?)\)/g,"%($1/)").replace(/（(.*?)）/g,"%($1/)").replace(/／/g,"|"),d+=(w==q?"</div><div>":"")+'<div class="problem">'+s.quizlet[u[w]]+"<br>"+(/\|/.test(b)?b.replace("}","|answer}"):b)+"</div>";s.quizlet=d+"</div></div>"}else"kana"==s.format&&(s.quizlet=s.chart)}else if("practice"==s.format&&(s.quizlet=s.quizlet[e],"fill"==s.type)){var z=t.querySelector(".multi-quiz-image");z&&(z.style.display="none")}i.generateQuiz(s)}}),!1!==r&&(n.callback(),GenkiModal.close()),!1}if("drag"==s.type){var d,u,g='<div id="quiz-info">'+s.info+'</div><div id="question-list">',h='<div id="drop-list">',p=[];for(o in s.quizlet)p.push(o);for(d=p.slice(0);p.length;)o=Math.floor(Math.random()*p.length),g+='<div class="quiz-item" '+((y=/\|/.test(p[o])?'data-helper="'+p[o].split("|").pop()+'"':null)||"")+">"+(y?p[o].replace(/(.*?)\|(.*)/,'$1<span class="hidden-text">$2</span>'):p[o])+"</div>",h+='<div tabindex="0" class="quiz-answer-zone'+(/\|/.test(p[o])?" helper-answer":"")+'" data-text="'+p[o].replace(/\|.*?$/,"")+'" data-mistakes="0"></div>',p.splice(o,1),++i.stats.problems,!u&&y&&(u=!0);for(g+="</div>"+h+"</div>",u&&(a.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),g+='<div id="answer-list">';d.length;)g+='<div tabindex="0" class="quiz-item" data-answer="'+d[o=Math.floor(Math.random()*d.length)].replace(/\|.*?$/,"")+'">'+s.quizlet[d[o]]+"</div>",d.splice(o,1);g+="</div>",a.innerHTML=g+i.lang.review.replace("</div>",i.lang.toggle_furigana+"</div>")}else if("kana"==s.type){g='<div id="quiz-info">'+s.info+'</div><div id="question-list" class="clear">';var m,k='<div id="answer-list">',f=[],v=s.quizlet;for(o=v.length-1;o>-1;o--){g+='<div class="quiz-column">';for(m in v[o])g+='<div class="quiz-item-row"><div tabindex="0" class="quiz-answer-zone" data-text="'+v[o][m]+'" data-mistakes="0"></div><div class="quiz-item">'+v[o][m]+"</div></div>",f.push('<div tabindex="0" class="quiz-item" data-answer="'+v[o][m]+'">'+m+"</div>"),++i.stats.problems;g+="</div>"}for(;f.length;)k+=f[o=Math.floor(Math.random()*f.length)],f.splice(o,1);a.innerHTML=g+"</div>"+k+"</div>"+i.lang.review}else if("writing"==s.type){g='<div id="quiz-info">'+s.info+"<br>If you don't know how to type in Japanese on your computer, please visit our help page by <a href=\"../../../help/writing/"+i.local+'" target="_blank">clicking here</a>.</div><div id="question-list">';var b='style="width:'+100/((j=s.columns)+1)+'%;"',w=0,y=!1;for(o in s.quizlet){for(g+='<div class="quiz-answer-row'+(s.quizlet[o]?" furi-row":"")+'"><div class="quiz-item" data-helper="'+s.quizlet[o]+'" '+b+'><div class="quiz-item-text">'+o+"</div></div>",l=0;j-- >0;)g+='<div class="writing-zone" '+b+'><input class="writing-zone-input" type="text" '+(!s.quiz&&l++<3?'placeholder="'+o+'"':"")+' data-answer="'+(s.quiz?s.quizlet[o]:o)+'" data-mistakes="0" tabindex="0" '+(s.quiz?"":'oninput="Genki.check.value(this);"')+' onfocus="Genki.input.index = '+w+++'"></div>',++i.stats.problems;g+="</div>",j=s.columns}/data-helper/.test(g)&&(y=!0,a.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),a.innerHTML=g+"</div>"+i.lang.check_answers.replace("</div>",y?i.lang.toggle_furigana+"</div>":"</div>"),s.quiz&&(a.className+=" no-helper"),i.input={map:t.querySelectorAll(".writing-zone-input"),index:0},i.input.map[0].autofocus=!0}else if("multi"==s.type){g='<div id="quiz-info">'+s.info+'</div><div id="question-list">',k='<div id="answer-list">';var q=65,x=!1;for(y=!1,o=0,l=(I=s.quizlet).length;o<l;o++){if(g+='<div id="quiz-q'+o+'" class="question-block" data-qid="'+(o+1)+'" style="display:none;"><div class="quiz-multi-question">'+(void 0!==I[o].question?I[o].question.replace(/\{.*?\}/g,function(e){var t=e.slice(1,e.length-1).split("|");if("!IMG"==t[0])return i.parse.image(t)}):'<div class="text-passage'+(I[o].vertical?" vertical-text":"")+'" '+(I[o].text.replace(/<br>/g,"").length<50?'style="text-align:center;"':"")+">"+I[o].text+"</div>"+(I[o].helper||""))+"</div>",I[o].text)g+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, true);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, true);">NEXT</div></div>',++i.stats.exclude;else for(;I[o].answers.length;)N=Math.floor(Math.random()*I[o].answers.length),/^A|^\!/.test(I[o].answers[N])&&("A"==I[o].answers[N].charAt(0)&&(x=!0),I[o].answers[N]=I[o].answers[N].slice(1)),g+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer" data-answer="'+x+'" data-option="'+String.fromCharCode(q++)+'" onclick="Genki.progressQuiz(this);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this);">'+I[o].answers[N]+"</div></div>",x=!1,I[o].answers.splice(N,1);g+="</div>",q=65,++i.stats.problems}/class="furigana"|class="inline-furi"|<ruby>/.test(g)&&(y=!0,a.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),a.innerHTML=g+'</div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div><div id="review-exercise" class="center clearfix">'+(i.appendix?"":'<button class="button text-selection-mode-button" onclick="Genki.toggle.textSelection(this);"><i class="fa">&#xf246;</i> Enable Text Selection</button>')+(y?i.lang.toggle_furigana:"")+"</div>",i.progressQuiz("init")}else if("fill"==s.type){y=!1;/class="furigana"|class="inline-furi"|<ruby>/.test(s.quizlet)&&(y=!0,a.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),a.innerHTML='<div id="quiz-info">'+s.info+"<br>If you don't know how to type in Japanese on your computer, please visit our help page by <a href=\"../../../help/writing/"+i.local+'" target="_blank">clicking here</a>.</div><div class="text-block">'+s.quizlet.replace(/\{.*?\}/g,function(e){var t,s,a,n=e.slice(1,e.length-1).split("|");return"!IMG"==n[0]?i.parse.image(n):"!AUDIO"==n[0]?'<div class="audio-block center"><audio id="'+n[1]+'" controls><source src="'+getPaths()+"resources/audio/"+("lessons-3rd"==i.ed?"3rd-edition/":"2nd-edition/")+n[1]+'.mp3" type="audio/mpeg"></audio></div>':"!PLAY"==n[0]?'<button class="button play-button" onclick="Genki.playAudio(\''+n[1]+"', "+n[2]+');"><i class="fa">&#xf04b;</i></button>':(t=n[1]?n[1]:"",s=(n[6]||n[5]||n[4]||n[3]||n[2]?n[6]||n[5]||n[4]||n[3]||n[2]:"").split(";"),(/\%\((.*?)\)/.test(t)||/\%\((.*?)\)/.test(n[0]))&&(a=[n[0].match(/%\((.*?)\)/),t.match(/%\((.*?)\)/)]),++i.stats.problems,'<span class="writing-zone"><input class="writing-zone-input" type="text" data-answer="'+n[0]+'" '+("answer"==s[0]?'data-answer2="'+t+'" ':"")+("answer"==s[0]&&n[3]?'data-answer3="'+n[2]+'" ':"")+("answer"==s[0]&&n[4]?'data-answer4="'+n[3]+'" ':"")+("answer"==s[0]&&n[5]?'data-answer5="'+n[4]+'" ':"")+("answer"==s[0]&&n[6]?'data-answer6="'+n[5]+'" ':"")+("furigana"==s[0]?'data-furigana="'+t+'" ':"")+("placeholder"==s[0]?'placeholder="'+t+'" ':"")+'data-mistakes="0" tabindex="0" style="width:'+(/width:/.test(s[0])?s[0].split(":")[1]:s[1]&&/width:/.test(s[1])?s[1].split(":")[1]:s[2]&&/width:/.test(s[2])?s[2].split(":")[1]:a?(t?(a[0]&&a[0][1]||"/").split("/").concat((a[1]&&a[1][1]||"/").split("/")):(a[0]&&a[0][1]||"/").split("/")).sort(function(e,t){return t.length-e.length})[0].length*(14/(/[a-z]/i.test(t||n[0])&&!/[\u3000-\u30FF]/.test(t||n[0])?2:1))+14+[t.replace(/\%\((.*?)\)/g,""),n[0].replace(/\%\((.*?)\)/g,"")].sort(function(e,t){return t.length-e.length})[0].length*(14/(/[a-z]/i.test(t||n[0])&&!/[\u3000-\u30FF]/.test(t||n[0])?2:1)):[t,n[0]].sort(function(e,t){return t.length-e.length})[0].length*(14/(/[a-z]/i.test(t||n[0])&&!/[\u3000-\u30FF]/.test(t||n[0])?2:1))+14)+'px;">'+(t&&!/answer|furigana|placeholder/.test(s[0])||s[1]&&/hint:/.test(s[1])||s[2]&&/hint:/.test(s[2])?'<span class="problem-hint">'+(s[1]&&/hint:/.test(s[1])?s[1].split(":")[1]:s[2]&&/hint:/.test(s[2])?s[2].split(":")[1]:t)+"</span>":"")+"</span>")})+"</div>"+i.lang.check_answers.replace("()","(false, 'fill')").replace("</div>",y?i.lang.toggle_furigana+"</div>":"</div>"),t.querySelector(".writing-zone-input").autofocus=!0}else if("stroke"==s.type){g='<div id="quiz-info">'+s.info+'</div><div id="question-list">',k='<div id="answer-list">';var z=storageOK&&"false"==localStorage.strokeOrderVisible,T=storageOK&&"false"==localStorage.tracingGuideVisible;for(o=0,l=(I=s.quizlet).length;o<l;o++)g+='<div id="quiz-q'+o+'" class="question-block" data-qid="'+(o+1)+'" style="display:none;"><div class="quiz-multi-question"><div class="kanji-container big-kanji">'+I[o].kanji+'</div><div class="kanji-stroke-order"><a href="https://jisho.org/search/'+I[o].kanji+'%20%23kanji" target="_blank" title="View stroke order on jisho.org"><button class="button"><i class="fa">&#xf002;</i></button></a><a href="'+getPaths()+"resources/images/stroke-order/"+I[o].order+'.png" target="_blank" title="Click to view image"><img src="'+getPaths()+"resources/images/stroke-order/"+I[o].order+'.png" alt="stroke order"/></a></div></div><div class="quiz-multi-row"><canvas class="kanji-canvas" data-kanji="'+I[o].kanji+'" data-strokes="'+I[o].strokes+'" data-guide="'+!T+'" id="canvas-'+o+'" width="200" height="200"></canvas></div><div class="kanji-canvas-actions quiz-multi-row center"><button class="button" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+o+'"><i class="fa">&#xf12d;</i>Erase</button><button class="button" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+o+'"><i class="fa">&#xf0e2;</i>Undo</button>'+(i.debug?'<button class="button" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+o+'" title="Open console (F12) to see recognition candidates"><i class="fa">&#xf188;</i>Test Recognition</button>':"")+'</div><div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, false, \'stroke\');" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, false, \'stroke\');" data-canvas="canvas-'+o+'">Next Kanji</div></div></div>',++i.stats.problems;a.innerHTML=g+'</div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div><div id="review-exercise" class="center clearfix"><button id="toggle-stroke-order" class="button" onclick="Genki.toggle.strokeOrder(this);"><i class="fa">&#xf1fc;</i>'+(z?"Show":"Hide")+' Stroke Order</button><button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this);"><i class="fa">&#xf031;</i>'+(T?"Show":"Hide")+' Tracing Guide</button><button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i>Show Stroke Numbers</button></div>',z&&(a.className+=" stroke-order-hidden"),i.progressQuiz("init",!1,"stroke")}else if("drawing"==s.type){g='<div id="quiz-info">'+s.info+'</div><div id="question-list">',b='style="width:'+100/((j=s.columns)+1)+'%;"';var j,I=s.quizlet,N=0;for(o=0,l=s.quizlet.length;o<l;o++){for(g+='<div class="quiz-answer-row"><div class="drawing-zone" '+b+'><div class="quiz-item"><div class="quiz-item-text">'+I[o].kanji+'</div></div><button class="button stroke-order-button" onclick="Genki.viewStrokeOrder(\''+I[o].kanji+"', '"+I[o].order+"');\">Stroke Order</button></div>";j-- >0;)g+='<div class="drawing-zone" '+b+'><canvas class="kanji-canvas" data-kanji="'+I[o].kanji+'" data-guide="'+!(s.columns-j>3)+'" data-strokes="'+I[o].strokes+'" data-size="100" id="canvas-'+N+'" width="100" height="100"></canvas><div class="kanji-canvas-actions"><button class="button icon-only" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+N+'" title="Erase"><i class="fa">&#xf12d;</i></button><button class="button icon-only" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+N+'" title="Undo"><i class="fa">&#xf0e2;</i></button>'+(i.debug?'<button class="button icon-only" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+N+'" title="Test Recognition"><i class="fa">&#xf188;</i></button>':"")+"</div></div>",++i.stats.problems,++N;g+="</div>",j=s.columns}a.innerHTML=g+"</div>"+i.lang.check_answers.replace("()","(false, 'drawing')").replace("</div>",'<button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i>Show Stroke Numbers</button></div>');var M=t.querySelectorAll(".kanji-canvas");for(o=0,l=M.length;o<l;o++)KanjiCanvas.init(M[o].id)}if("drag"==s.type||"kana"==s.type){var S=dragula([t.querySelector("#answer-list")],{isContainer:function(e){return e.classList.contains("quiz-answer-zone")}});S.on("drag",function(e){i.isTouch&&i.isTouching&&"hidden"!=t.body.style.overflow&&(t.body.style.overflow="hidden"),i.markedItem&&(i.markedItem.className=i.markedItem.className.replace(" markedItem",""),i.markedItem=null),i.markedItem=e,e.className+=" markedItem"}),i.isTouch&&S.on("cancel",function(){t.body.style.overflow=""}),S.on("drop",function(e,s,a){i.isTouch&&(t.body.style.overflow=""),s.dataset.text&&(e.dataset.answer!=s.dataset.text?(t.getElementById("answer-list").appendChild(e),s.dataset.mistakes=++s.dataset.mistakes,++i.stats.mistakes):(s.className+=" answer-correct",i.markedItem&&(i.markedItem.className=i.markedItem.className.replace(" markedItem",""),i.markedItem=null),++i.stats.solved==i.stats.problems&&i.endQuiz()))}),i.drake=S,["click","keypress"].forEach(function(e){t.addEventListener(e,function(e){if(!("keypress"==e.type&&"Enter"!=e.key||i.quizOver)){for(var s=e.target,a=3;a-- >0&&(a<2&&(s=s.parentNode),!/quiz-item|quiz-answer-zone/.test(s.className)););/quiz-item/.test(s.className)&&"answer-list"==s.parentNode.id?(i.markedItem&&(i.markedItem.className=i.markedItem.className.replace(" markedItem","")),i.markedItem=s,i.markedItem.className+=" markedItem"):i.markedItem&&/quiz-answer-zone/.test(s.className)?i.markedItem.dataset.answer!=s.dataset.text?(i.wrongTimeout&&(t.getElementById("wrongAnswer").id="",clearTimeout(i.wrongTimeout),delete i.wrongTimeout),s.id="wrongAnswer",i.wrongTimeout=setTimeout(function(){t.getElementById("wrongAnswer").id="",delete i.wrongTimeout},1e3),s.dataset.mistakes=++s.dataset.mistakes,++i.stats.mistakes):(s.className+=" answer-correct",s.appendChild(i.markedItem),s.tabIndex=-1,s.firstChild.tabIndex=-1,i.markedItem.className=i.markedItem.className.replace(" markedItem",""),i.markedItem=null,++i.stats.solved==i.stats.problems&&i.endQuiz()):i.markedItem&&(i.markedItem.className=i.markedItem.className.replace(" markedItem",""),i.markedItem=null),"click"==e.type&&/quiz-answer-zone/.test(e.target.className)&&e.target.blur()}})})}var E=new Timer,H=t.getElementById("quiz-timer");if(H.innerHTML="00:00:00",E.start(),E.addEventListener("secondsUpdated",function(e){H.innerHTML=E.getTimeValues().toString()}),i.timer=E,t.getElementById("exercise").className+=" content-loaded "+("stroke"==s.type?"stroke-quiz multi":s.type)+"-quiz",i.scrollTo("#exercise-title",!0),(i.debug||!/drag|kana|drawing/.test(s.type)&&!i.appendix)&&(i.debug||s.format&&!/vocab|kana|numbers/.test(s.format)||!s.format)&&i.quickJisho.create(),"fill"==s.type||"writing"==s.type){var J=t.querySelector("[autofocus]");J&&J!=t.activeElement&&(J.focus(),i.debug&&console.warn("autofocus failed: HTMLElement.focus() will be used as a fallback."))}if(i.debug){var L=t.querySelectorAll("AUDIO");for(o=0,l=L.length;o<l;o++)L[o].ontimeupdate=function(){console.log(this.id,this.currentTime)};i.exerciseData=s}},incrementProgressBar:function(){var e=t.getElementById("quiz-progress-bar"),s=Math.floor((i.stats.solved+1)/i.stats.problems*100);e.style.width=s+"%",e.innerHTML='<span id="quiz-progress-text">'+(i.stats.solved+1)+"/"+i.stats.problems+"</span>"},progressQuiz:function(e,s,a){if(i.textSelectMode||i.quizOver)return!1;if("init"==e)t.getElementById("quiz-q"+i.stats.solved).style.display="",i.incrementProgressBar();else{if(e&&"stroke"==a){var n=KanjiCanvas.recognize(e.dataset.canvas);e=e.parentNode.parentNode.querySelector(".kanji-canvas"),i.debug&&console.log("toDraw: "+e.dataset.kanji),i.debug&&console.log("Results: "+n),i.debug&&console.log("Correct: "+(new RegExp(e.dataset.kanji).test(n)&&e.dataset.strokesAnswer==e.dataset.strokes).toString()),e.dataset.answer=new RegExp(e.dataset.kanji).test(n)&&e.dataset.strokesAnswer==e.dataset.strokes}e.className+=" selected-answer",s&&(e.parentNode.className+=" hidden-answer"),"false"==e.dataset.answer&&(e.parentNode.parentNode.className+=" wrong-answer",++i.stats.mistakes);var r=t.getElementById("quiz-q"+i.stats.solved++),o=t.getElementById("quiz-q"+i.stats.solved);if(o)o.style.display="",r.style.display="none",i.incrementProgressBar();else{i.endQuiz("stroke"==a?a:"multi");for(var l=t.querySelectorAll('[id^="quiz-q"]'),c=0,d=l.length;c<d;c++)l[c].style.display="";t.getElementById("quiz-progress").style.display="none"}}"stroke"==a&&t.getElementById("canvas-"+i.stats.solved)&&KanjiCanvas.init("canvas-"+i.stats.solved)},endQuiz:function(s){i.quizOver=!0;var a=i.stats.solved-i.stats.exclude,n=i.stats.problems-i.stats.exclude;i.stats.score=Math.floor(100*(a-i.stats.mistakes)/n),i.timer.stop();var r=t.getElementById("quiz-timer");r.style.display="none",t.getElementById("quiz-result").innerHTML='<div id="complete-banner" class="center">Quiz Complete!</div><div id="result-list"><div class="result-row"><span class="result-label">Problems Solved:</span>'+n+'</div><div class="result-row"><span class="result-label">Answers Wrong:</span>'+i.stats.mistakes+'</div><div class="result-row"><span class="result-label">Score:</span>'+i.stats.score+'%</div><div class="result-row"><span class="result-label">Completion Time:</span>'+r.innerHTML+'</div><div class="result-row center">'+(100==i.stats.score?"PERFECT! Great Job, you have mastered this quiz! Feel free to move on or challenge yourself by trying to beat your completion time.":i.stats.score>70?"Nice work! "+i.lang[s?s+"_mistakes":"mistakes"]:"Keep studying! "+i.lang[s?s+"_mistakes":"mistakes"])+(t.querySelector(".alt-phrase")?"<br><br>"+i.lang.sub_answers:"")+'<div class="center">'+(/\/dictionary\//.test(e.location)?i.lang.back_to_dict:'<a href="./'+i.local+i.debug+'" class="button"><i class="fa">&#xf021;</i>Try Again</a>')+'<button class="button" onclick="Genki.breakTime();"><i class="fa">&#xf0f4;</i>Take a Break</button><a href="'+t.getElementById("home-link").href+'" class="button"><i class="fa">&#xf015;</i>Back to Index</a></div></div></div>',/drawing|stroke/.test(s)&&(t.getElementById("toggle-stroke-numbers").style.display=""),"stroke"==s&&(t.getElementById("toggle-tracing-guide").style.display="none"),t.getElementById("exercise").className+=" quiz-over",i.scrollTo("#complete-banner",!0)},breakTime:function(){GenkiModal.open({title:"Take a Break?",content:"Taking a break and waiting before trying again can greatly help with building your memory. When you try to recall something as it fades away, you're telling your brain that you shouldn't forget that item. However, if you keep bringing up the same item over and over again in a short period of time, you're less likely to remember, because that item will be kept in your brain's short-term memory.<br><br>5 to 10 minute breaks are recommended before trying again, but you're free to adjust the time to your liking.<br><br>"+'<div class="center">Wait <input id="break-minutes" class="center" type="number" value="5" min="1" max="60"> Minute(s)</div>',buttonText:"Wait",keepOpen:!0,callback:function(){i.local||!i.canNotify||/denied|granted/.test(Notification.permission)||Notification.requestPermission();var s,a=+t.getElementById("break-minutes").value;a>60?a=60:a<=0&&(a=1),GenkiModal.open({title:"Taking a Break",content:'<div id="break-timer" class="center">00:'+(a<10?"0":"")+a+":00</div>",buttonText:"End Break Time",keepOpen:!0,callback:function(){location.reload()}}),t.body.className+=" taking-a-break",s=Math.floor(10*Math.random())+1,t.getElementById("genki-modal-overlay").style.backgroundImage="url(../../../resources/images/backgrounds/bg-"+(s<10?"0":"")+s+".jpg)";var n=new Timer,r=t.getElementById("break-timer");n.start({startValues:{minutes:a},target:{seconds:0},countdown:!0}),n.addEventListener("secondsUpdated",function(s){var a=n.getTimeValues().toString();if(r.innerHTML=a,"00:00:00"==a&&(r.innerHTML='Break time is up!<div style="font-size:15px;">Click the button below to resume your studies.</div>',t.getElementById("genki-modal-ok").style.display="inline-block",!i.local&&i.canNotify&&"granted"==Notification.permission)){new Notification(t.title.replace(/ \| Genki Study Resources.*$/,""),{body:"Break time is up!",icon:t.querySelector('meta[property="og:image"]').content,tag:"breakTime-"+i.active.index}).onclick=function(){e.focus(),this.close()}}})}})},review:function(){GenkiModal.open({title:"Activate Review Mode?",content:"Are you sure you want to review? Your current progress will be lost.",callback:function(){for(var s=t.querySelectorAll("[data-answer]"),a=0,n=s.length;a<n;a++)t.querySelector('[data-text="'+s[a].dataset.answer+'"]').appendChild(s[a]);i.timer.stop(),i.drake.destroy(),t.getElementById("quiz-timer").style.display="none",t.getElementById("review-exercise").innerHTML=(/\/dictionary\//.test(e.location)?i.lang.back_to_dict:'<a href="./'+i.local+i.debug+'" class="button"><i class="fa">&#xf021;</i>Restart</a>')+(t.querySelector(".drag-quiz")?i.lang.toggle_furigana:""),t.getElementById("quiz-info").innerHTML='You are currently in review mode; go ahead and take your time to study. When you are ready to practice this exercise, click the "restart" button.'}})},check:{busy:!1,value:function(e){i.check.busy||e.value!=e.dataset.answer||(i.check.busy=!0,setTimeout(function(){var t=i.input.map[i.input.index+1];t?t.focus():(e.blur(),i.check.answers(!0)),i.check.busy=!1},50))},answers:function(e,s){!i.exerciseComplete&&GenkiModal.open({title:"Check Answers?",content:e?"The last input field has been filled in. Are you ready to check your answers?":"Checking your answers will end the quiz. Do you want to continue?",callback:function(){if(i.exerciseComplete=!0,t.querySelector("#check-answers button").style.display="none",s&&"drawing"==s)for(var e,a=0,n=(d=t.querySelectorAll(".kanji-canvas")).length;a<n;a++)e=KanjiCanvas.recognize(d[a].id),i.debug&&console.log("toDraw: "+d[a].dataset.kanji),i.debug&&console.log("Results: "+e),i.debug&&console.log("Correct: "+(new RegExp(d[a].dataset.kanji).test(e)&&d[a].dataset.strokesAnswer==d[a].dataset.strokes).toString()),new RegExp(d[a].dataset.kanji).test(e)&&d[a].dataset.strokesAnswer==d[a].dataset.strokes?d[a].dataset.answer=!0:(d[a].dataset.answer=!1,++i.stats.mistakes),++i.stats.solved;else{var r,o,l,c,d,u,g=t.querySelectorAll("#exercise .writing-zone-input");for(a=0,n=g.length;a<n;a++){o=!1,c=g[a].dataset,l=g[a].value.toLowerCase();for(r in c)if(/answer/.test(r)){if(d=c[r].toLowerCase(),/%\(.*?\)/.test(d))if(u=d.replace(/.*?%\((.*?)\).*/,"$1").split("/"),"answer"==r||"answer2"==r)for(;u.length;){if(l==d.replace(/%\(.*?\)/,u[0])){o=!0;break}u.splice(0,1)}else"answer3"!=r&&"answer4"!=r&&"answer5"!=r&&"answer6"!=r||-1==u.indexOf(l)||(o=!0);else l==d&&(o=!0);if(o)break}o?g[a].parentNode.className+=" answer-correct":(++c.mistakes,++i.stats.mistakes,"fill"==s&&g[a].parentNode.insertAdjacentHTML("beforeend",('<span class="problem-answer">'+c.answer+(c.answer2||c.furigana?'<span class="secondary-answer'+(c.furigana?" furigana-only":"")+'">'+(c.answer2||c.furigana)+"</span>":"")+"</span>").replace(/%\((.*?)\)/g,function(e,t){return'<span class="alt-phrase">(</span>'+t.replace(/\//g,'<span class="alt-phrase-sep">/</span>')+'<span class="alt-phrase">)</span>'}))),++i.stats.solved,g[a].disabled=!0}}i.endQuiz(s||"writing")}})}},toggle:{exerciseList:function(e){e.className="list-open"==e.className?"":"list-open"},list:function(e){var t="lesson-title",i=t+" lesson-open";e.className=e.className==i?t:i;for(var s=e.parentNode.querySelectorAll(".lesson-title"),a=0,n=s.length;a<n;a++)s[a]!=e&&(s[a].className=t)},furigana:function(e){var s=t.getElementById("quiz-zone"),a=storageOK&&localStorage.furiganaVisible||(/helper-hidden/.test(s.className)?"false":"true");switch(a){case"true":a="false",s.className=s.className.replace("helper-present","helper-hidden"),e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":a="true",s.className=s.className.replace("helper-hidden","helper-present"),e.innerHTML=e.innerHTML.replace("Show","Hide")}i.lang.toggle_furigana=e.outerHTML,storageOK&&(localStorage.furiganaVisible=a)},strokeNumbers:function(e){t.getElementById("quiz-zone");switch(i.strokeNumberDisplay){case!0:i.strokeNumberDisplay=!1,e.innerHTML=e.innerHTML.replace("Hide","Show");break;case!1:i.strokeNumberDisplay=!0,e.innerHTML=e.innerHTML.replace("Show","Hide")}for(var s=t.querySelectorAll(".kanji-canvas"),a=0,n=s.length;a<n;a++)KanjiCanvas["canvas_"+s[a].id]&&KanjiCanvas.redraw(s[a].id,!1,i.strokeNumberDisplay)},strokeOrder:function(e){var i=t.getElementById("quiz-zone"),s=storageOK&&localStorage.strokeOrderVisible||(/stroke-order-hidden/.test(i.className)?"false":"true");switch(s){case"true":s="false",i.className=i.className+=" stroke-order-hidden",e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":s="true",i.className=i.className.replace(" stroke-order-hidden",""),e.innerHTML=e.innerHTML.replace("Show","Hide")}storageOK&&(localStorage.strokeOrderVisible=s)},tracingGuide:function(e){t.getElementById("quiz-zone");var i=storageOK&&localStorage.tracingGuideVisible?localStorage.tracingGuideVisible:"true";switch(i){case"true":i="false",e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":i="true",e.innerHTML=e.innerHTML.replace("Show","Hide")}for(var s=t.querySelectorAll(".kanji-canvas"),a=0,n=s.length;a<n;a++)s[a].dataset.guide=i,KanjiCanvas["canvas_"+s[a].id]&&KanjiCanvas.redraw(s[a].id,!0);storageOK&&(localStorage.tracingGuideVisible=i)},textSelection:function(e){var s=t.getElementById("quiz-zone");switch(i.textSelectMode){case!0:i.textSelectMode=!1,s.className=s.className.replace(" text-selection-mode",""),e.innerHTML=e.innerHTML.replace("Dis","En");break;case!1:i.textSelectMode=!0,s.className=s.className+=" text-selection-mode",e.innerHTML=e.innerHTML.replace("En","Dis")}}},create:{exerciseButtons:function(){for(var e,s='<div class="more-exercises clear">',a=2;a-- >0;)(e=i.exercises[1==a?i.active.index-1:i.active.index+1])&&!/^\.\.\//.test(e)&&(e=e.split("|"),s+='<a href="../../../'+i.ed+"/"+e[0]+"/"+i.local+i.debug+'" class="button '+(1==a?"prev":"next")+'-ex" title="'+(1==a?"Previous":"Next")+' exercise">'+e[1]+"</a>");t.getElementById("quiz-timer").insertAdjacentHTML("afterend",s+"</div>")},exerciseList:function(){for(var s,a,n,r='class="lesson-title" onclick="Genki.toggle.list(this);" onkeydown="event.key == \'Enter\' && Genki.toggle.list(this);" tabindex="0"',o='<nav id="exercise-list"><h3 class="main-title">Exercise List</h3><button id="random-exercise" class="button" onclick="Genki.randomExercise();" title="Random Exericse"><i class="fa">&#xf074;</i></button><div id="lessons-list"><h4 '+r+'>Page links</h4><ul id="page-links">',l="\\.\\.\\/",c=0,d=i.exercises.length,u="",g=/workbook-\d+|literacy-\d+|literacy-wb-\d+/,h={workbook:"Workbook",literacy:"Reading and Writing","literacy-wb":"Workbook: Reading and Writing"};c<d;c++)n=(s=i.exercises[c].split("|"))[0].replace(/^lesson-\d+\/|-\d+$/g,""),new RegExp(l).test(s[0])||(o+="</ul><h4 "+r+">"+(l=/^appendix/.test(s[0])?"appendix":/^study-tools/.test(s[0])?"study-tools":s[0].replace(/(lesson-\d+)\/.*/,"$1")).charAt(0).toUpperCase()+l.replace(/-/," ").slice(1)+'</h4><ul id="'+l+'">',u=""),g.test(s[0])&&u!=n&&(o+='<li><h4 class="sub-lesson-title">'+h[u=n]+"</h4></li>"),o+='<li><a href="'+("\\.\\.\\/"==l?s[0]:"../../../"+i.ed+"/"+s[0]+"/")+i.local+i.debug+'" '+(s[2]?'data-page="Genki '+(+s[0].replace(/lesson-(\d+).*/,"$1")<13?"I":"II")+(/workbook-|wb-/.test(s[0])?" Workbook":"")+": "+s[2]+'"':"")+' title="'+s[1]+'">'+s[1]+"</a></li>";t.getElementById("content").insertAdjacentHTML("afterbegin",'<a href="#toggle-exercises" id="toggle-exercises" onclick="Genki.toggle.exerciseList(this); return false;" title="Toggle exercise list"></a>'+o+"</ul></div></nav>"),i.active.exercise&&(i.toggle.list(t.getElementById(/^appendix/.test(i.active.exercise[0])?"appendix":/^study-tools/.test(i.active.exercise[0])?"study-tools":i.active.exercise[0].replace(/(lesson-\d+)\/.*/,"$1")).previousSibling),(a=t.querySelector('a[href*="'+i.active.exercise[0]+'"]')).className+=" active-lesson",t.getElementById("lessons-list").scrollTop=a.offsetTop-(a.getBoundingClientRect().height+(e.matchMedia&&matchMedia("(pointer:coarse)").matches?0:6)))}},parse:{image:function(e){var t=/^http/.test(e[1])?e[1]:"../../../resources/images/lesson-images/"+e[1];return'<a href="'+t+'" target="blank" title="View full image" class="lesson-image"><img src="'+t+'" alt="'+(e[2]||e[1])+'" /></a>'}},quickJisho:{hidden:!0,selectorHidden:!0,tabbing:!1,create:function(){var e=t.createElement("DIV"),s=t.createElement("DIV"),a=t.createElement("BUTTON"),n=t.createDocumentFragment();e.id="quick-jisho-toggle",e.innerHTML='<i class="fa">&#xf02d;</i>',e.title="Toggle Quick Dictionary",e.tabIndex=0,e.onclick=i.quickJisho.toggle,e.onkeypress=function(e){"Enter"==e.key&&i.quickJisho.toggle()},s.id="quick-jisho-window",s.className="quick-jisho-hidden",s.innerHTML='<h3 id="quick-jisho-title" class="main-title">Quick Dictionary <span id="quick-jisho-hits"></span></h3><div id="quick-jisho-content"><div class="quick-jisho-row center"><input tabindex="0" id="quick-jisho-search" type="text" placeholder="Search..." oninput="Genki.quickJisho.search(this.value);"></div><div class="quick-jisho-row"><ul id="quick-jisho-results"></ul></div></div>',a.id="quick-jisho-selector",a.className="button",a.style.display="none",a.innerHTML='<i class="fa">&#xf002;</i>Look up',a.onclick=i.quickJisho.lookUp,a.tabIndex=0,n.appendChild(s),n.appendChild(e),n.appendChild(a),t.body.appendChild(n),t.querySelector(".footer-right").style.marginRight="25px",i.quickJisho.cache={box:s,search:t.getElementById("quick-jisho-search"),results:t.getElementById("quick-jisho-results"),hits:t.getElementById("quick-jisho-hits"),selector:t.getElementById("quick-jisho-selector")},t.onselectionchange=i.quickJisho.getSelection,t.onmousemove=function(e){i.quickJisho.x=Math.abs(e.pageX-t.body.clientWidth)<100?e.pageX-95:e.pageX,i.quickJisho.y=Math.abs(e.pageY-t.body.clientHeight)<40?e.pageY-32:e.pageY+12},t.onkeydown=function(e){"Tab"!=e.key||i.quickJisho.selectorHidden||t.activeElement==i.quickJisho.cache.selector||(i.quickJisho.tabbing=!0,i.quickJisho.cache.selector.focus(),e.preventDefault())}},toggle:function(){if(!i.jisho&&!i.quickJisho.loading){i.quickJisho.loading=!0;var e=t.createElement("SCRIPT");e.src=getPaths()+"resources/javascript/jisho.min.js",e.onload=function(){i.quickJisho.cache.search.value&&i.quickJisho.search(i.quickJisho.cache.search.value),i.quickJisho.loading=!1},t.body.appendChild(e)}i.quickJisho.hidden?(i.quickJisho.cache.box.className="",i.quickJisho.hidden=!1,i.quickJisho.cache.search.focus()):(i.quickJisho.cache.box.className="quick-jisho-hidden",i.quickJisho.hidden=!0)},search:function(t,s){i.quickJisho.searchTimeout&&e.clearTimeout(i.quickJisho.searchTimeout),i.quickJisho.searchTimeout=e.setTimeout(function(){var e,a,n,r,o,l="",c=0;if(i.quickJisho.cache.results.innerHTML="",t){t=t.toLowerCase();for(e in i.jisho)for(a=0,n=i.jisho[e].length;a<n;a++)for(r in i.jisho[e][a])if(-1!=i.jisho[e][a][r].toLowerCase().indexOf(t)){l+='<li tabindex="0" class="definition clear"><span class="def-ja'+((o=i.jisho[e][a].ja.split("|"))[1]?" def-furi":"")+'">'+o[0]+(o[1]?"<i>"+o[1]+"</i>":"")+'</span><span class="def-en">'+i.jisho[e][a].en+"</span>"+(i.jisho[e][a].v?' <span class="def-vtype">[<i>'+i.jisho[e][a].v+"</i>]</span>":"")+'<span class="def-label">'+i.jisho[e][a].l+"</span>",c++;break}}if(!s&&!l&&t&&/[\u3400-\u9faf]/.test(t)){var d=t.match(/[\u3400-\u9faf]+/);d&&d[0]&&i.quickJisho.search(d[0],!0)}else i.quickJisho.cache.results.innerHTML=l||(t?'<li>No results found for "'+t+'".</li>':""),i.quickJisho.cache.hits.innerHTML=c?"("+c+")":"";delete i.quickJisho.searchTimeout},300)},lookUp:function(){i.quickJisho.hidden&&i.quickJisho.toggle(),i.quickJisho.cache.search.value="".trim?i.quickJisho.selectedText.trim():i.quickJisho.selectedText,i.quickJisho.search(i.quickJisho.cache.search.value),this.style.display="none",i.quickJisho.selectorHidden=!0},getSelection:function(){if(i.quickJisho.tabbing)return i.quickJisho.tabbingOff||(i.quickJisho.tabbingOff=setTimeout(function(){i.quickJisho.tabbing=!1,delete i.quickJisho.tabbingOff},10)),!1;if(t.getSelection){var e=t.getSelection();"Range"==e.type&&e.toString&&!/quick-jisho/.test(e.focusNode.className)?(i.quickJisho.selectedText=e.toString(),i.quickJisho.cache.selector.style.left=i.quickJisho.x+"px",i.quickJisho.cache.selector.style.top=i.quickJisho.y+"px",i.quickJisho.selectorHidden&&(i.quickJisho.cache.selector.style.display="",i.quickJisho.selectorHidden=!1)):(i.quickJisho.selectedText="",i.quickJisho.selectorHidden||(i.quickJisho.cache.selector.style.display="none",i.quickJisho.selectorHidden=!0))}}},playAudio:function(e,i){var s=t.getElementById(e);s&&(s.currentTime=i,s.play())},viewStrokeOrder:function(e,t){GenkiModal.open({title:e+" Stroke Order",content:'<div class="kanji-stroke-order center"><div class="big-kanji">'+e+'</div><a href="https://jisho.org/search/'+e+'%20%23kanji" target="_blank" title="View stroke order on jisho.org"><button class="button"><i class="fa">&#xf002;</i></button></a><a href="'+getPaths()+"resources/images/stroke-order/"+t+'.png" target="_blank" title="Click to view image"><img src="'+getPaths()+"resources/images/stroke-order/"+t+'.png" alt="stroke order"/></a></div>'})},getAlts:function(e,t,s){for(var a,n,r,o,l=t.split("|"),c=l.length,d=Math.pow(2,c),u=[],g=0;g<d;++g)n=0,o=e.replace(/\{(.*?)\}/g,function(e,t){return r=n++,1<<(a=c-1-r)&g?l[r]:t}),u.push(o);if(i.debug){var h=u.length;console[h/d*100==100?"log":"warn"](h+"/"+d+" ("+h/d*100+"% combo coverage for "+c+" replacements; "+(d-h)+" missing combos)",u)}return s?u:"%("+u.join("/")+")|"},randomExercise:function(){var t=i.exercises[Math.floor(Math.random()*i.exercises.length)].split("|");/lesson-\d+/.test(t[0])?e.location.href="../../../"+i.ed+"/"+t[0]+"/"+i.local+i.debug:i.randomExercise()},init:function(){for(var s,a=0,n=i.exercises.length,r=t.getElementById("quiz-result");a<n;a++)if(i.active.path==i.exercises[a].split("|")[0]){i.active.exercise=i.exercises[a]?i.exercises[a].split("|"):null,i.active.index=a;break}i.active.exercise?(s=/^appendix/.test(i.active.exercise[0])?"appendix":/^study-tools/.test(i.active.exercise[0])?"study-tools":+i.active.exercise[0].replace(/lesson-(\d+).*/,"$1"),r.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center" '+(i.active.exercise[2]?'data-page="Genki '+(s<13?"I":"II")+(/workbook-|wb-/.test(i.active.exercise[0])?" Workbook":"")+": "+i.active.exercise[2]+'"':"")+">"+("appendix"==s?"巻末":"study-tools"==s?"ツール":"第"+s+"課")+" - "+i.active.exercise[1]+"</h2>")):r.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center">'+t.querySelector("TITLE").innerText.replace(/\s\|.*/,"")+"</h2>"),i.isTouch&&(t.ontouchstart=function(){i.isTouching=!0},t.ontouchend=function(){i.isTouching=!1},t.ontouchcancel=function(){i.isTouching=!1}),i.create.exerciseButtons(),i.create.exerciseList(),e.Genki=this}};i.init()}(window,document);