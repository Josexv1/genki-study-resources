!function(j,L){"use strict";var C={stats:{problems:0,solved:0,mistakes:0,score:0,exclude:0},canNotify:"Notification"in j,isTouch:"ontouchstart"in j||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,isTouching:!1,isTimerPausedByPopup:!1,feedbackMode:storageOK&&localStorage.feedbackMode?localStorage.feedbackMode:"classic",textSelectMode:!1,strokeNumberDisplay:!1,markedItem:null,ed:"lessons"+(/lessons-3rd/.test(j.location.pathname)?"-3rd":""),local:"file:"==j.location.protocol?"index.html":"",debug:/debug/.test(j.location.search)?"?debug":"",lang:{std_drag:"Drag the English expression to the Japanese expression that has the same meaning.<br>TIP: Click an expression to mark it, then click an empty field to drop the answer there.",std_kana:"Drag the Kana to the matching Romaji.<br>TIP: Click the kana to mark it, then click an empty field to drop the answer there.",std_num:"Drag the Numbers to the matching Kana.<br>TIP: Click a number to mark it, then click an empty field to drop the answer there.",std_multi:"Solve the problems by choosing the correct answers.",std_questions:"Answer the questions as best as you can.",std_culture:"Answer the questions about Japanese culture as best as you can.",std_stroke_order:"Practice drawing each kanji by following the stroke order.",std_drawing:"Practice drawing the following kanji multiple times.",vocab_multi:"Choose the correct definition for each Japanese expression.",vocab_writing:"Practice spelling the following words/expressions.",vocab_fill:"Write the Japanese definition for the following words/expressions.",kana_multi:"Choose the correct Romaji for the %{KANA}.",kana_writing:"Practice writing the following %{KANA}.",kana_fill:"Complete the chart by filling in the Romaji.",num_multi:"Read the Japanese and choose the correct numbers.",num_writing:"Practice spelling the following numbers.",num_fill:"Write the following numbers in Japanese (hiragana).",kanji_readings_multi:"Choose the correct readings for each kanji.",kanji_readings_drag:"Match each kanji with their readings.",kanji_yomikata:'</div><p class="text-block" style="margin:10px 0;">▶ indicates the <em>on-yomi</em> (pronunciation originally borrowed from Chinese).<br>▷ indicates the <em>kun-yomi</em> (native Japanese reading).</p>',kanji_meanings_multi:"Choose the correct meanings for each kanji.",kanji_meanings_drag:"Match each kanji with their meanings.",opts:{kana:{kana:"Drag and Drop",multi:"Multiple Choice",writing:"Writing Practice",fill:"Fill in the Chart"},numbers:{drag:"Drag and Drop",multi:"Multiple Choice",writing:"Spelling Practice",fill:"Write the Numbers"},kanji:{multi:"Multiple Choice",drag:"Drag and Drop"},vocab:{drag:"Drag and Drop",multi:"Multiple Choice",writing:"Spelling Practice",fill:"Write the Definition"},practice:{multi:"Multiple Choice",fill:"Written",drag:"Drag and Drop"},hirakata:{fill:"Written",stroke:"Stroke Order Practice",drawing:"Drawing Practice"}},mistakes:'The items outlined in <span class="t-red t-bold">red</span> were answered wrong before finding the correct answer. Review these problems before trying again.',writing_mistakes:'The items outlined in <span class="t-red t-bold">red</span> were answered wrong. Review these problems before trying again.',multi_mistakes:'The answers you selected that were wrong are outlined in <span class="t-red t-bold">red</span>. The correct answers are outlined in <span class="t-blue t-bold">blue</span>. Review these problems before trying again.',stroke_mistakes:'The characters you drew that were wrong are outlined in <span class="t-red t-bold">red</span>. Please review the stroke order and number of strokes for these characters before trying again.<br><br><b>Note:</b> Sometimes answers may be marked wrong by mistake, due to a mismatch in the recognition algorithm.<br>Please use your own discretion if this occurs.',fill_mistakes:'The items underlined in <span class="t-red t-bold">red</span> were answered wrong, the correct answers are listed underneath in <span class="t-green t-bold">green</span>. Review these problems before trying again.',sub_answers:'<b>Note:</b> Answers inside <span class="t-blue t-bold">blue</span> parentheses separated by "<span class="alt-phrase-sep">/</span>" are a list of possible sub-answers; only one can be used.<br>For example.. <span class="t-green"><span class="alt-phrase">(</span>あの<span class="alt-phrase-sep">/</span>その<span class="alt-phrase">)</span>ねこ</span>: そのねこ or あのねこ <span class="t-green">(good)</span> vs あの/そのねこ <span class="t-red">(bad)</span><br><span class="t-green"><span class="alt-phrase">(</span>この<span class="alt-phrase-sep">/</span><span class="alt-phrase">)</span>ねこ</span> means the sub-answer is optional; it can be left out.',review:'<div id="review-exercise" class="center clearfix"><button id="review-button" class="button" onclick="Genki.review();"><i class="fa">&#xf02d;</i>Review</button></div>',toggle_furigana:'<button id="toggle-furigana" class="button" onclick="Genki.toggle.furigana(this);"><i class="fa">&#xf2a8;</i>'+(storageOK&&"false"==localStorage.furiganaVisible?"Show":"Hide")+" Furigana</button>",check_answers:'<div id="check-answers" class="center"><button id="check-answers-button" class="button" onclick="Genki.check.answers();"><i class="fa">&#xf00c;</i>Check Answers</button></div>',back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i>Back to Dictionary</button>'},active:{type:null,exercise:null,index:0,path:j.location.pathname.replace(/.*?\/lessons.*?\/(.*?\/.*?)\/.*/g,"$1")},exercises:j.GenkiExercises||null,scrollTo:function(e,t){"string"==typeof e&&(e=L.querySelector(e));function i(){L.body.scrollTop=e.offsetTop,L.documentElement.scrollTop=e.offsetTop}t?setTimeout(i,100):i()},QuizType:{DRAG:"drag",KANA:"kana",WRITING:"writing",MULTI:"multi",FILL:"fill",STROKE:"stroke",DRAWING:"drawing"},generateQuiz:function(q){!C.exerciseData&&j.JSON&&(C.exerciseData=JSON.stringify(q));var e=L.getElementById("quiz-zone");if("object"==typeof q.type){for(var t=!!/(?:begin|start)=\d/.test(j.location.search)&&j.location.search.replace(/.*?(?:begin|start)=(\d).*/,"$1"),i=0,a=q.type.length,s="";i<a;i++)s+='<option value="'+i+'"'+(!1!==t?i==t?" selected":"":storageOK&&localStorage["genki_pref_"+q.format]==q.type[i]?" selected":"")+">"+C.lang.opts[q.format][q.type[i]]+"</option>";return w=GenkiModal.open({title:"Please Select an Exercise Type",content:'Please select the type of exercise you would like to do, then click "Begin" to start studying.<br><br><div class="center">'+(/\/dictionary\/|\/custom-vocab\//.test(j.location)?"":"<div><b>Current Exercise</b><br>"+L.title.replace(/ \| Genki Study Resources.*$/,"")+"</div><br>")+'<div><b>Exercise Type</b><br><select id="exercise-type">'+s+'</select></div><br><div title="The exercise type can still be changed via the Change Exercise Type button at the bottom of an exercise."><input id="modal-skip-ex-type" class="genki_input_hidden" type="checkbox"'+(storageOK&&"true"==localStorage.genkiSkipExType?" checked":"")+' onchange="localStorage.genkiSkipExType = this.checked"><span tabindex="0" class="genki_pseudo_checkbox" onclick="this.previousSibling.click();" onkeypress="event.key == \'Enter\' && this.previousSibling.click();"></span><label class="checkbox-label" for="modal-skip-ex-type">Skip Exercise Type Selection</label></div></div>',buttonText:"Begin",noClose:1,zIndex:"low",callback:function(){var e,t=L.getElementById("exercise-type").value;if(q.type=q.type[t],q.info="object"==typeof q.info&&q.info[t]?q.info[t]:q.info,storageOK&&(localStorage["genki_pref_"+q.format]=q.type),/vocab|kana|numbers|kanji/.test(q.format)){if("kana"==q.format&&"kana"!=q.type){var i={};for(y in q.quizlet)for(l in q.quizlet[y])i[l]=q.quizlet[y][l];q.quizlet=i,q.info=q.info.replace("%{KANA}",C.active.exercise[1].replace(/.*?(Hiragana|Katakana).*/,"$1"))}if("kanji"==q.format){if(q.readings){for(y in q.quizlet){var a=q.quizlet[y].split("|");q.quizlet[y]=(a[0]?'<span class="yomikata" title="on-yomi">▶</span>'+a[0]+"<br>":"")+(a[1]?'<span class="yomikata" title="kun-yomi">▷</span>'+a[1]:"")}q.info+=C.lang.kanji_yomikata}"drag"==q.type&&(L.getElementById("exercise").className+=q.readings?" kanji-readings":q.meanings?" kanji-meanings":"")}if("multi"==q.type){var s,n,r,o,l,c,d=[],u=[],g=[];for(y in q.quizlet)u.push(y),g.push(y);for(y=0,w=u.length;y<w;y++){for(v=u[x=Math.floor(Math.random()*u.length)].split("|"),s=q.quizlet[u[x]].replace(/\|.*?$/,""),n=/\|/.test(q.quizlet[u[x]])?q.quizlet[u[x]].replace(/.*?\|(.*?$)/,"$1"):"",d.push({question:'<div class="multi-vocab">'+(v[1]?"<ruby>":"kanji"==q.format?'<div class="big-kanji">':"")+v[0]+(v[1]?"<rt>"+v[1]+"</rt></ruby>":"kanji"==q.format?"</div>":"")+(n?'<hr><div class="multi-vocab-sentence">'+n+"</div>":"")+"</div>",answers:["A"+s]}),(o=g.slice()).splice(x,1),l=3;0<l--&&o.length;)c=Math.floor(Math.random()*o.length),(r=q.quizlet[o[c]].replace(/\|.*?$/,""))==s?l++:d[y].answers.push("A"==r.charAt(0)?"!"+r:r),o.splice(c,1);u.splice(x,1)}q.quizlet=d}else if("writing"==q.type){d={};for(y in q.quizlet)for(var p,h,m=(p=y.split("|"))[0].split("／"),k=0,f=m.length;k<f;k++)h=p[1]||("kana"==q.format?q.quizlet[y]:""),d[m[k].replace(/\(.*?\)|（.*?）|～/g,"")]=h,/\(.*?\)|（.*?）/.test(m[k])&&(d[m[k].replace(/～|\(|\)|（|）/g,"")]=h);q.quizlet=d,q.columns=6}else if("fill"==q.type)if(/vocab|numbers/.test(q.format)){var v,b,y,w,x,d='<div class="count-problems columns-2 clear"><div>',u=[];for(y in q.quizlet)u.push(y);for(y=0,w=u.length,x=Math.ceil(w/2);y<w;y++)b=("{"+(v=u[y].split("|"))[0].replace(/。|～/g,"")+(v[1]?"|"+v[1].replace(/。|～/g,""):"")+(/。|～/g.test(v[0])?"|"+v[0]:"")+(v[1]&&/。|～/g.test(v[1])?"|"+v[1]:"")+"}").replace(/\((.*?)\)/g,"%($1/)").replace(/（(.*?)）/g,"%($1/)").replace(/／/g,"|"),d+=(y==x?"</div><div>":"")+'<div class="problem">'+q.quizlet[u[y]].replace(/\|.*?$/,"")+"<br>"+(/\|/.test(b)?b.replace("}","|answer}"):b)+"</div>";q.quizlet=d+"</div></div>"}else"kana"==q.format&&(q.quizlet=q.chart)}else"practice"==q.format?(q.quizlet=q.quizlet[t],e=L.querySelector(".multi-quiz-image"),"fill"==q.type&&e?e.style.display="none":"multi"==q.type&&e&&(e.style.display="")):"hirakata"==q.format&&(q.quizlet=q.quizlet[t]||q.quizlet[q.quizlet.length-1]);C.generateQuiz(q),C.changingExType=!1}}),!C.changingExType&&(!1!==t||storageOK&&"true"==localStorage.genkiSkipExType)&&(w.callback(),GenkiModal.close()),C.create.exerciseTypeButton(),!1}if(C.active.type=q.type,"drag"==q.type){var n,r,o='<div id="quiz-info">'+q.info+'</div><div id="question-list">',l='<div id="drop-list">',c=[];for(i in q.quizlet)c.push(i);for(n=c.slice(0);c.length;)i=Math.floor(Math.random()*c.length),o+='<div class="quiz-item-group"><div class="quiz-item" '+((k=/\|/.test(c[i])?'data-helper="'+c[i].split("|").pop()+'"':null)||"")+">"+(k?c[i].replace(/(.*?)\|(.*)/,'$1<span class="hidden-text">$2</span>'):c[i])+"</div></div>",l+='<div tabindex="0" class="quiz-answer-zone'+(/\|/.test(c[i])?" helper-answer":"")+'" data-text="'+c[i].replace(/\|.*?$/,"")+'" data-mistakes="0"></div>',c.splice(i,1),++C.stats.problems,!r&&k&&(r=!0);for(o+="</div>"+l+"</div>",r&&(e.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),o+='<div id="answer-list">';n.length;)o+='<div tabindex="0" class="quiz-item" data-answer="'+n[i=Math.floor(Math.random()*n.length)].replace(/\|.*?$/,"")+'"><div class="quiz-item-text">'+q.quizlet[n[i]].replace(/\|.*?$/,"")+"</div></div>",n.splice(i,1);e.innerHTML=(o+="</div>")+C.lang.review.replace("</div>",C.lang.toggle_furigana+'<button id="toggle-orientation" class="button" onclick="Genki.toggle.vocabOrientation(this);"><i class="fa" style="position:relative;transform:rotate(90deg);">&#xf0db;</i>Horizontal Mode</button></div>'),storageOK&&"true"==localStorage.vocabHorizontal&&C.toggle.vocabOrientation(L.getElementById("toggle-orientation"),"false")}else if("kana"==q.type){for(var d,o='<div id="quiz-info">'+q.info+'</div><div id="question-list" class="clear">',u='<div id="answer-list">',g=[],p=q.quizlet,i=p.length-1;-1<i;i--){for(d in o+='<div class="quiz-column">',p[i])o+='<div class="quiz-item-row"><div tabindex="0" class="quiz-answer-zone" data-text="'+p[i][d]+'" data-mistakes="0"></div><div class="quiz-item">'+p[i][d]+"</div></div>",g.push('<div tabindex="0" class="quiz-item" data-answer="'+p[i][d]+'">'+d+"</div>"),++C.stats.problems;o+="</div>"}for(;g.length;)u+=g[i=Math.floor(Math.random()*g.length)],g.splice(i,1);e.innerHTML=o+"</div>"+u+"</div>"+C.lang.review}else if("writing"==q.type){var o='<div id="quiz-info">'+q.info+"<br>If you don't know how to type in Japanese on your computer, please visit our help page by <a href=\"../../../help/writing/"+C.local+'" target="_blank">clicking here</a>.</div><div id="question-list">',h='style="width:'+100/((z=q.columns)+1)+'%;"',m=0,k=!1;for(i in q.quizlet){for(o+='<div class="quiz-answer-row'+(q.quizlet[i]?" furi-row":"")+'"><div class="quiz-item" data-helper="'+q.quizlet[i]+'" '+h+'><div class="quiz-item-text">'+i+"</div></div>",a=0;0<z--;)o+='<div class="writing-zone" '+h+'><input class="writing-zone-input" type="text" '+(!q.quiz&&a++<3?'placeholder="'+i+'"':"")+' data-answer="'+(q.quiz?q.quizlet[i]:i)+'" data-mistakes="0" tabindex="0" '+(q.quiz?"":'oninput="Genki.check.value(this);"')+' onfocus="Genki.input.index = '+m+++'"></div>',++C.stats.problems;o+="</div>",z=q.columns}/data-helper/.test(o)&&(k=!0,e.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),e.innerHTML=o+"</div>"+C.lang.check_answers.replace("</div>",k?C.lang.toggle_furigana+"</div>":"</div>"),q.quiz&&(e.className+=" no-helper"),C.input={map:L.querySelectorAll(".writing-zone-input"),index:0},C.input.map[0].autofocus=!0}else if("multi"==q.type){for(var o='<div id="quiz-info">'+q.info+'<br><b style="color:#6F6;">NEW:</b> You can now choose between "Instant" and "Classic" Feedback Mode for multiple choice quizzes in the <a href="#genki-site-settings" onclick="GenkiSettings.manager(); return false;">Site Settings</a>.</div><div id="question-list">',u='<div id="answer-list">',f=65,v=!1,k=!1,b=/"format":"vocab"/.test(C.exerciseData),i=0,a=(T=q.quizlet).length;i<a;i++){if(o+='<div id="quiz-q'+i+'" class="question-block" data-qid="'+(i+1)+'" style="display:none;"><div class="quiz-multi-question">'+(q.questionsAlignLeft?'<div class="quiz-question-inner-text">':"")+(void 0!==T[i].question?T[i].question.replace(/\{.*?\}/g,function(e){e=e.slice(1,e.length-1).split("|");if("!IMG"==e[0])return C.parse.image(e)}):'<div class="text-passage'+(T[i].vertical?" vertical-text":"")+'" '+(T[i].text.replace(/<br>/g,"").length<50?'style="text-align:center;"':"")+">"+T[i].text+"</div>"+(T[i].helper||""))+(q.questionsAlignLeft?"</div>":"")+"</div>"+(b?'<button class="button vocab-spoiler-toggle" onclick="Genki.toggle.vocabSpoiler(this);"><i class="fa"></i>Show Choices</button><div class="vocab-spoiler">':""),T[i].text)o+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, true);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, true);">NEXT</div></div>',++C.stats.exclude;else for(;T[i].answers.length;)S=Math.floor(Math.random()*T[i].answers.length),/^A|^\!/.test(T[i].answers[S])&&("A"==T[i].answers[S].charAt(0)&&(v=!0),T[i].answers[S]=T[i].answers[S].slice(1)),o+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer" data-answer="'+v+'" data-option="'+String.fromCharCode(f++)+'" onclick="Genki.progressQuiz(this);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this);"><div class="quiz-answer-inner-text">'+T[i].answers[S]+"</div></div></div>",v=!1,T[i].answers.splice(S,1);o+=(b?"</div>":"")+"</div>",f=65,++C.stats.problems}/class="furigana"|class="inline-furi"|<ruby>/.test(o)&&(k=!0,e.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),b&&storageOK&&"true"==localStorage.spoilerMode&&(e.className+=" spoiler-mode"),e.innerHTML=o+'</div><div id="next-button" class="quiz-multi-row" style="margin-top:-20px; visibility:hidden;'+("classic"==C.feedbackMode?"display:none;":"")+'"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.showNextQuestion(this);" onkeypress="event.key == \'Enter\' && Genki.showNextQuestion(this);">NEXT</div></div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div><div id="review-exercise" class="center clearfix">'+(C.appendix?"":'<button class="button text-selection-mode-button" onclick="Genki.toggle.textSelection(this);"><i class="fa">&#xf246;</i> Enable Text Selection</button>')+(k?C.lang.toggle_furigana:"")+"</div>",C.progressQuiz("init")}else if("fill"==q.type){k=!1;/class="furigana"|class="inline-furi"|<ruby>/.test(q.quizlet)&&(k=!0,e.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),e.innerHTML='<div id="quiz-info">'+q.info+"<br>If you don't know how to type in Japanese on your computer, please visit our help page by <a href=\"../../../help/writing/"+C.local+'" target="_blank">clicking here</a>.</div><div class="text-block">'+q.quizlet.replace(/\{.*?\}/g,function(e){var t,i,a,s,e=e.slice(1,e.length-1).split("|");return"!IMG"==e[0]?C.parse.image(e):"!AUDIO"==e[0]?'<div class="audio-block center"><audio id="'+e[1]+'" controls><source src="'+getPaths()+"resources/audio/"+("lessons-3rd"==C.ed?"3rd-edition/":"2nd-edition/")+e[1]+'.mp3" type="audio/mpeg"></audio></div>':"!PLAY"==e[0]?'<button class="button play-button" onclick="Genki.playAudio(\''+e[1]+"', "+e[2]+');"><i class="fa">&#xf04b;</i></button>':(t=e[1]||"",i=(e[10]||e[9]||e[8]||e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||"").split(";"),(/\%\((.*?)\)/.test(t)||/\%\((.*?)\)/.test(e[0]))&&(a=[e[0].match(/%\((.*?)\)/),t.match(/%\((.*?)\)/)]),++C.stats.problems,a=/width:/.test(i[0])?i[0].split(":")[1]:i[1]&&/width:/.test(i[1])?i[1].split(":")[1]:i[2]&&/width:/.test(i[2])?i[2].split(":")[1]:a?(t?(a[0]&&a[0][1]||"/").split("/").concat((a[1]&&a[1][1]||"/").split("/")):(a[0]&&a[0][1]||"/").split("/")).sort(function(e,t){return t.length-e.length})[0].length*(14/(/[a-z]/i.test(t||e[0])&&!/[\u3000-\u30FF]/.test(t||e[0])?2:1))+14+[t.replace(/\%\((.*?)\)/g,""),e[0].replace(/\%\((.*?)\)/g,"")].sort(function(e,t){return t.length-e.length})[0].length*(14/(/[a-z]/i.test(t||e[0])&&!/[\u3000-\u30FF]/.test(t||e[0])?2:1)):[t,e[0]].sort(function(e,t){return t.length-e.length})[0].length*(14/(/[a-z]/i.test(t||e[0])&&!/[\u3000-\u30FF]/.test(t||e[0])?2:1))+14,s=/placeholder:/.test(i[0])?i[0].split(":")[1]:i[1]&&/placeholder:/.test(i[1])?i[1].split(":")[1]:i[2]&&/placeholder:/.test(i[2])?i[2].split(":")[1]:null,'<span class="writing-zone"><input class="writing-zone-input" type="text" data-answer="'+e[0]+'" '+("answer"==i[0]?'data-answer2="'+t+'" ':"")+("answer"==i[0]&&e[3]?'data-answer3="'+e[2]+'" ':"")+("answer"==i[0]&&e[4]?'data-answer4="'+e[3]+'" ':"")+("answer"==i[0]&&e[5]?'data-answer5="'+e[4]+'" ':"")+("answer"==i[0]&&e[6]?'data-answer6="'+e[5]+'" ':"")+("answer"==i[0]&&e[7]?'data-answer7="'+e[6]+'" ':"")+("answer"==i[0]&&e[8]?'data-answer8="'+e[7]+'" ':"")+("answer"==i[0]&&e[9]?'data-answer9="'+e[8]+'" ':"")+("answer"==i[0]&&e[10]?'data-answer10="'+e[9]+'" ':"")+("furigana"==i[0]?'data-furigana="'+t+'" ':"")+("placeholder"==i[0]||s?'placeholder="'+(s||t)+'" ':"")+'data-mistakes="0" tabindex="0" data-default-width="'+a+'" style="width:'+a*(storageOK&&localStorage.genkiFontSize?+localStorage.genkiFontSize/100:1)+'px;">'+(t&&!/answer|furigana|placeholder/.test(i[0])||i[1]&&/hint:/.test(i[1])||i[2]&&/hint:/.test(i[2])?'<span class="problem-hint">'+(i[1]&&/hint:/.test(i[1])?i[1].split(":")[1]:i[2]&&/hint:/.test(i[2])?i[2].split(":")[1]:t)+"</span>":"")+"</span>")})+"</div>"+C.lang.check_answers.replace("()","(false, 'fill')").replace("</div>",k?C.lang.toggle_furigana+"</div>":"</div>"),L.querySelector(".writing-zone-input").autofocus=!0}else if("stroke"==q.type){for(var y,o='<div id="quiz-info">'+q.info+'</div><div id="question-list">',u='<div id="answer-list">',w=storageOK&&"false"==localStorage.strokeOrderVisible,x=storageOK&&"false"==localStorage.tracingGuideVisible,i=0,a=(T=q.quizlet).length;i<a;i++)T[i].kana&&(T[i].kanji=T[i].kana),q.kanaType&&(q.kanaType=q.kanaType.charAt(0).toUpperCase()+q.kanaType.slice(1).toLowerCase()),y=getPaths()+"resources/images/stroke-order/"+T[i].order+".png",o+='<div id="quiz-q'+i+'" class="question-block" data-qid="'+(i+1)+'" style="display:none;"><div class="quiz-multi-question"><div class="kanji-container big-kanji'+(T[i].kana?" kana-font":"")+'"'+(T[i].font?' style="font-family:'+T[i].font+'"':"")+">"+T[i].kanji+'</div><div class="kanji-stroke-order"><a class="button-link" href="'+(T[i].kana?getPaths()+"resources/images/stroke-order/sasagami-"+q.kanaType.toLowerCase()+".jpg":"https://jisho.org/search/"+T[i].kanji+"%20%23kanji")+'" target="_blank" title="View stroke order '+(T[i].kana?"chart":"on jisho.org")+'"><button class="button"><i class="fa">&#xf002;</i></button></a><a href="'+y+'" target="_blank" title="Click to view image"><img src="'+y+'" alt="stroke order"/></a></div></div><div class="quiz-multi-row"><canvas class="kanji-canvas" data-kanji="'+T[i].kanji+'" data-strokes="'+T[i].strokes+'" data-guide="'+!x+'"'+(T[i].kana&&!T[i].font?' data-font="NotoSansJP, SawarabiGothic, MS Gothic, Yu Gothic, Meiryo"':T[i].font?' data-font="'+T[i].font+'"':"")+' id="canvas-'+i+'" width="200" height="200"'+(T[i].kana?'data-kana="true"':"")+'></canvas></div><div class="kanji-canvas-actions quiz-multi-row center"><button class="button" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+i+'" title="(CTRL+X)"><i class="fa">&#xf12d;</i>Erase</button><button class="button" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+i+'" title="(CTRL+Z)"><i class="fa">&#xf0e2;</i>Undo</button>'+(C.debug?'<button class="button" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+i+'" title="Open console (F12) to see recognition candidates (CTRL+F)"><i class="fa">&#xf188;</i>Test Recognition</button>':"")+'</div><div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, false, \'stroke\');" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, false, \'stroke\');" data-canvas="canvas-'+i+'">Next '+(T[i].kana?q.kanaType:"Kanji")+"</div></div></div>",++C.stats.problems;e.innerHTML=o+'</div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div><div id="review-exercise" class="center clearfix"><button id="toggle-stroke-order" class="button" onclick="Genki.toggle.strokeOrder(this);"><i class="fa">&#xf1fc;</i>'+(w?"Show":"Hide")+' Stroke Order</button><button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this);"><i class="fa">&#xf031;</i>'+(x?"Show":"Hide")+' Tracing Guide</button><button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i>Show Stroke Numbers</button></div>',w&&(e.className+=" stroke-order-hidden"),C.progressQuiz("init",!1,"stroke")}else if("drawing"==q.type){for(var z,o='<div id="quiz-info">'+q.info+'</div><div id="question-list">',x=storageOK&&"false"==localStorage.tracingGuideVisible,h='style="width:'+100/((z=q.columns)+1)+'%;"',T=q.quizlet,S=0,i=0,a=q.quizlet.length;i<a;i++){for(T[i].kana&&(T[i].kanji=T[i].kana),o+='<div class="quiz-answer-row"><div class="drawing-zone" '+h+'><div class="quiz-item"><div class="quiz-item-text'+(T[i].kana?" kana-font":"")+'"'+(T[i].font?' style="font-family:'+T[i].font+'"':"")+">"+T[i].kanji+'</div></div><button class="button stroke-order-button" onclick="Genki.viewStrokeOrder(\''+T[i].kanji+"', '"+T[i].order+"'"+(T[i].kana?",'"+q.kanaType+"'":"")+');">Stroke Order</button></div>';0<z--;)o+='<div class="drawing-zone" '+h+'><canvas class="kanji-canvas" data-kanji="'+T[i].kanji+'" data-guide="'+(!(3<q.columns-z)&&!x)+'"'+(T[i].kana&&!T[i].font?' data-font="NotoSansJP, SawarabiGothic, MS Gothic, Yu Gothic, Meiryo"':T[i].font?' data-font="'+T[i].font+'"':"")+' data-strokes="'+T[i].strokes+'" data-size="100" id="canvas-'+S+'" width="110" height="110"'+(T[i].kana?'data-kana="true"':"")+'></canvas><div class="kanji-canvas-actions"><button class="button icon-only" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+S+'" title="Erase (CTRL+X)"><i class="fa">&#xf12d;</i></button><button class="button icon-only" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+S+'" title="Undo (CTRL+Z)"><i class="fa">&#xf0e2;</i></button>'+(C.debug?'<button class="button icon-only" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+S+'" title="Test Recognition (CTRL+F)"><i class="fa">&#xf188;</i></button>':"")+"</div></div>",++C.stats.problems,++S;o+="</div>",z=q.columns}e.innerHTML=o+"</div>"+C.lang.check_answers.replace("()","(false, 'drawing')").replace("</div>",'<button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this, true);"><i class="fa">&#xf031;</i>'+(x?"Show":"Hide")+' Tracing Guide</button><button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i>Show Stroke Numbers</button></div>');for(var N=L.querySelectorAll(".kanji-canvas"),i=0,a=N.length;i<a;i++)KanjiCanvas.init(N[i].id)}if(C.currentAnswers){if(q.type==C.currentAnswers.type)for(i=0,a=(I=L.querySelectorAll(".writing-zone-input")).length;i<a;i++)I[i].value=C.currentAnswers.list[i];delete C.currentAnswers}"drag"!=q.type&&"kana"!=q.type||((w=dragula([L.querySelector("#answer-list")],{isContainer:function(e){return e.classList.contains("quiz-answer-zone")}})).on("drag",function(e){C.isTouch&&C.isTouching&&"hidden"!=L.body.style.overflow&&(L.body.style.overflow="hidden"),C.markedItem&&(C.markedItem.className=C.markedItem.className.replace(" markedItem",""),C.markedItem=null),(C.markedItem=e).className+=" markedItem"}),C.isTouch&&w.on("cancel",function(){L.body.style.overflow=""}),w.on("drop",function(e,t,i){C.isTouch&&(L.body.style.overflow=""),t.dataset.text&&(e.dataset.answer!=t.dataset.text?(L.getElementById("answer-list").appendChild(e),t.dataset.mistakes=++t.dataset.mistakes,1<t.dataset.mistakes?C.stats.mistakes:++C.stats.mistakes):(t.className+=" answer-correct",C.markedItem&&(C.markedItem.className="quiz-item",C.markedItem=null),++C.stats.solved==C.stats.problems&&C.endQuiz()))}),C.drake=w,C.globalEventListenersSet)||(C.globalEventListenersSet=!0,["click","keypress"].forEach(function(e){L.addEventListener(e,function(e){if(!("keypress"==e.type&&"Enter"!=e.key||C.quizOver)){for(var t=e.target,i=4,a=i-1;0<i--&&(i<a&&(t=t.parentNode||t),!/quiz-item$|quiz-answer-zone/.test(t.className)););/quiz-item/.test(t.className)&&"answer-list"==t.parentNode.id?(C.markedItem&&(C.markedItem.className=C.markedItem.className.replace(" markedItem","")),C.markedItem=t,C.markedItem.className+=" markedItem"):C.markedItem&&/quiz-answer-zone/.test(t.className)?C.markedItem.dataset.answer!=t.dataset.text?(C.wrongTimeout&&(L.getElementById("wrongAnswer").id="",clearTimeout(C.wrongTimeout),delete C.wrongTimeout),t.id="wrongAnswer",C.wrongTimeout=setTimeout(function(){L.getElementById("wrongAnswer").id="",delete C.wrongTimeout},1e3),t.dataset.mistakes=++t.dataset.mistakes,++C.stats.mistakes):(t.className+=" answer-correct",t.appendChild(C.markedItem),t.tabIndex=-1,t.firstChild.tabIndex=-1,C.markedItem.className=C.markedItem.className.replace(" markedItem",""),C.markedItem=null,++C.stats.solved==C.stats.problems&&C.endQuiz()):C.markedItem&&(C.markedItem.className=C.markedItem.className.replace(" markedItem",""),C.markedItem=null),"click"==e.type&&/quiz-answer-zone/.test(e.target.className)&&e.target.blur()}})}));var E=new Timer,M=L.getElementById("quiz-timer");M.innerHTML="00:00:00",E.start(),E.addEventListener("secondsUpdated",function(e){M.innerHTML=E.getTimeValues().toString()}),C.timer=E,storageOK&&"false"!=localStorage.timerAutoPause&&L.addEventListener("visibilitychange",C.startOrPauseTimerByVisibility),L.getElementById("exercise").className+=" content-loaded "+("stroke"==q.type?"stroke-quiz multi":q.type)+"-quiz",C.scrollTo("#exercise-title",!0),!C.debug&&(/drag|kana|drawing/.test(q.type)||C.appendix)||!(C.debug||q.format&&!/vocab|kana|numbers/.test(q.format))&&q.format||C.quickJisho.create(),"fill"!=q.type&&"writing"!=q.type||(e=L.querySelector("[autofocus]"))&&e!=L.activeElement&&(e.focus(),C.debug)&&console.warn("autofocus failed: HTMLElement.focus() will be used as a fallback."),"multi"==q.type&&(T=L.querySelector(L.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer"))&&T.focus();for(var I,i=0,a=(I=L.querySelectorAll("AUDIO")).length;i<a;i++)I[i].onplay=function(){for(var e=L.querySelectorAll("AUDIO"),t=0,i=e.length;t<i;t++)e[t]==this||e[t].paused||e[t].pause()},C.debug&&(I[i].ontimeupdate=function(){console.log(this.id,this.currentTime)})},incrementProgressBar:function(){var e=L.getElementById("quiz-progress-bar"),t=Math.floor((C.stats.solved+1)/C.stats.problems*100);e.style.width=t+"%",e.innerHTML='<span id="quiz-progress-text">'+(C.stats.solved+1)+"/"+C.stats.problems+"</span>"},progressQuiz:function(e,t,i){if(C.textSelectMode||C.quizOver)return!1;if("init"==e)L.getElementById("quiz-q"+C.stats.solved).style.display="",C.incrementProgressBar();else{e&&"stroke"==i&&(a=KanjiCanvas.recognize(e.dataset.canvas),e=e.parentNode.parentNode.querySelector(".kanji-canvas"),C.debug&&console.log("toDraw: "+e.dataset.kanji),C.debug&&console.log("Results: "+a),C.debug&&console.log("Correct: "+(new RegExp(e.dataset.kanji).test(a)&&e.dataset.strokesAnswer==e.dataset.strokes).toString()),e.dataset.answer=new RegExp(e.dataset.kanji).test(a)&&e.dataset.strokesAnswer==e.dataset.strokes),e.className+=" selected-answer",t&&(e.parentNode.className+=" hidden-answer"),"false"==e.dataset.answer&&(e.parentNode.parentNode.className+=" wrong-answer",++C.stats.mistakes);var a=L.getElementById("quiz-q"+C.stats.solved++),t=L.getElementById("quiz-q"+C.stats.solved);if(t)"instant"==C.feedbackMode&&"multi"==C.active.type?(C.multiNodes||(C.multiNodes={list:L.getElementById("question-list"),button:L.getElementById("next-button"),next:null,last:null}),C.quizOver=!0,C.multiNodes.list.className+=" multi-quiz quiz-over",C.multiNodes.button.style.visibility="visible",C.multiNodes.button.firstChild.focus(),C.multiNodes.next=t,C.multiNodes.last=a):(t.style.display="",a.style.display="none",(s=t.querySelector(L.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer"))&&s.focus(),C.incrementProgressBar());else{C.endQuiz(i==C.QuizType.STROKE?i:C.QuizType.MULTI);for(var s,n=0,r=(s=L.querySelectorAll('[id^="quiz-q"]')).length;n<r;n++)s[n].style.display="";L.getElementById("quiz-progress").style.display="none"}}"stroke"==i&&L.getElementById("canvas-"+C.stats.solved)&&KanjiCanvas.init("canvas-"+C.stats.solved)},showNextQuestion:function(e){C.multiNodes.next.style.display="",C.multiNodes.last.style.display="none",C.quizOver=!1,C.multiNodes.list.className=C.multiNodes.list.className.replace(" multi-quiz quiz-over",""),C.multiNodes.button.style.visibility="hidden";var t=C.multiNodes.next.querySelector(L.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer");t&&t.focus(),C.incrementProgressBar()},endQuiz:function(e){C.quizOver=!0,e="drawing"==e?"stroke":e;var t,i=C.stats.solved-C.stats.exclude,a=C.stats.problems-C.stats.exclude,i=(C.stats.score=Math.floor(100*(i-C.stats.mistakes)/a),C.timer.stop(),L.getElementById("quiz-timer")),i=(i.style.display="none",L.getElementById("quiz-result").innerHTML='<div id="complete-banner" class="center">Quiz Complete!</div><div id="result-list"><div class="result-row"><span class="result-label">Problems Solved:</span>'+a+'</div><div class="result-row"><span class="result-label">Answers Wrong:</span>'+C.stats.mistakes+'</div><div class="result-row"><span class="result-label">Score:</span>'+C.stats.score+'%</div><div class="result-row"><span class="result-label">Completion Time:</span>'+i.innerHTML+'</div><div class="result-row center">'+(100==C.stats.score?"PERFECT! Great Job, you have mastered this quiz! Feel free to move on or challenge yourself by trying to beat your completion time.":70<C.stats.score?"Nice work! "+C.lang[e?e+"_mistakes":"mistakes"]:"Keep studying! "+C.lang[e?e+"_mistakes":"mistakes"])+(L.querySelector(".alt-phrase")?"<br><br>"+C.lang.sub_answers:"")+'<div class="center">'+(/\/dictionary\//.test(j.location)?C.lang.back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i>Try Again</button>')+'<button class="button" onclick="Genki.breakTime();"><i class="fa">&#xf0f4;</i>Take a Break</button><a href="'+L.getElementById("home-link").href+'" class="button"><i class="fa">&#xf015;</i>Back to Index</a></div></div></div>',0<C.active.exercise.length&&!/appendix|study-tools/.test(C.active.exercise[0])&&(a=C.active.exercise[0],i=localStorage.GenkiEdition,(t=JSON.parse(localStorage.Results))[i]||(t[i]={}),(i=t[i])[a]=void 0===i[a]||C.stats.score>i[a]?C.stats.score:i[a],localStorage.Results=JSON.stringify(t),C.create.removeExerciseList(),C.create.exerciseList()),"stroke"==e&&(L.getElementById("toggle-stroke-numbers").style.display="",L.getElementById("toggle-tracing-guide").style.display="none"),C.drake&&setTimeout(function(){C.drake.destroy(),delete C.drake},100),L.getElementById("change-exercise-type-container"));i&&(i.style.display="none"),L.getElementById("exercise").className+=" quiz-over",C.scrollTo("#complete-banner",!0)},reset:function(e){if(j.JSON){if(!e&&/fill-quiz|writing-quiz/.test(L.getElementById("exercise").className)&&0<C.stats.mistakes)return GenkiModal.open({title:"Try again with your current answers?",content:"<div>Would you like to try again with your current answers? This will allow you to correct the answers you got wrong while preserving what you have already written.</div><br><div>※ Please note that your answers will be lost if you change the page or exercise type.</div>",buttonText:"Yes",closeButtonText:"No",customButton:'<button id="genki-modal-cancel" class="button" onclick="GenkiModal.close();">Cancel</button>',keepOpen:!0,callback:function(){for(var e=[],t=L.querySelectorAll(".writing-zone-input"),i=0,a=t.length;i<a;i++)e.push(t[i].value);C.currentAnswers={type:/fill-quiz/.test(L.getElementById("exercise").className)?"fill":"writing",list:e},GenkiModal.close(),C.reset(!0)},closeCallback:function(){GenkiModal.close(),C.reset(!0)}});C.exerciseComplete=!1,C.quizOver=!1,C.isTouching=!1,C.textSelectMode=!1,C.strokeNumberDisplay=!1,C.markedItem=null,C.stats={problems:0,solved:0,mistakes:0,score:0,exclude:0},C.multiNodes&&delete C.multiNodes,C.timer.isRunning()&&C.timer.stop(),C.quickJisho.cache&&(C.quickJisho.hidden||C.quickJisho.toggle(),C.quickJisho.search(""),C.quickJisho.cache.search.value="");var e=L.getElementById("exercise"),t=L.querySelector(".multi-quiz-image");e.className="content-block",e.innerHTML=L.getElementById("exercise-title").outerHTML+'<div id="quiz-result"></div><div id="quiz-zone" class="clear"></div>'+(t?t.outerHTML:"")+'<div id="quiz-timer" class="center"></div>'+L.querySelector(".more-exercises").outerHTML,C.appendix?(e.style.display="none",L.getElementById("appendix-tool").style.display="",C.scrollTo(/\/dictionary\//.test(j.location)?"#practice-words":".title"),/\/dictionary\//.test(j.location)?C.appendix.jisho.launchExercise():/\/map-of-japan\//.test(j.location)?C.appendix.studyMap():/\/numbers-chart\//.test(j.location)?C.appendix.studyChart("numbers"):/\/conjugation-chart\//.test(j.location)&&C.appendix.studyChart("conjugation")):C.tools?(e.style.display="none",L.getElementById("study-tool-editor").style.display="",C.scrollTo(".title")):C.generateQuiz(JSON.parse(C.exerciseData))}else j.location.reload()},breakTime:function(){GenkiModal.open({title:"Take a Break?",content:"Taking a break and waiting before trying again can greatly help with building your memory. 5 to 10 minute breaks are recommended, but you're free to adjust the time to your liking."+(/"format":"vocab"|"type":"drag"/.test(C.exerciseData)?' Please see <a href="'+getPaths()+"help/vocab-memorization/"+C.local+'" target="_blank">this page</a> for more tips on memorizing vocab.':"")+'<br><br><div class="center">Wait <input id="break-minutes" class="center" type="number" value="'+C.breakTimer[C.breakMultiplier]+'" min="1" max="60" onchange="Genki.changeBreakMultiplier(this);"> Minute(s)</div>',buttonText:"Wait",keepOpen:!0,callback:function(){C.breakMultiplier<C.breakTimer.length-1&&(2!=C.breakMultiplier||C.breakTimerCustom||(t=L.getElementById("toggle-furigana"))&&1==/helper-present/.test(L.getElementById("quiz-zone").className)&&t.click(),C.breakMultiplier++),C.local||!C.canNotify||/denied|granted/.test(Notification.permission)||Notification.requestPermission();var e,t=+L.getElementById("break-minutes").value,i=(60<t?t=60:t<=0&&(t=1),GenkiModal.open({title:"Taking a Break",content:'<div id="break-timer" class="center">00:'+(t<10?"0":"")+t+":00</div>",buttonText:"End Break Time",keepOpen:!!(C.appendix||!C.tools&&/"format"/.test(C.exerciseData)),callback:function(){C.reset(),L.body.className=L.body.className.replace(" taking-a-break","")}}),L.body.className+=" taking-a-break",e=Math.floor(10*Math.random())+1,L.getElementById("genki-modal-overlay").style.backgroundImage="url(../../../resources/images/backgrounds/bg-"+(e<10?"0":"")+e+".jpg)",new Timer),a=L.getElementById("break-timer");i.start({startValues:{minutes:t},target:{seconds:0},countdown:!0}),i.addEventListener("secondsUpdated",function(e){var t=i.getTimeValues().toString();"00:00:00"==(a.innerHTML=t)&&(a.innerHTML='Break time is up!<div style="font-size:15px;">Click the button below to resume your studies.</div>',L.getElementById("genki-modal-ok").style.display="inline-block",!C.local)&&C.canNotify&&"granted"==Notification.permission&&(new Notification(L.title.replace(/ \| Genki Study Resources.*$/,""),{body:"Break time is up!",icon:L.querySelector('meta[property="og:image"]').content,tag:"breakTime-"+C.active.index}).onclick=function(){j.focus(),this.close()})})}})},breakMultiplier:0,breakTimer:[5,10,15,20,30,40,50,60],breakTimerCustom:!1,changeBreakMultiplier:function(e){e=Number(e.value);e<=5?C.breakMultiplier=0:e<=10?C.breakMultiplier=1:e<=15?C.breakMultiplier=2:e<=20?C.breakMultiplier=3:e<=30?C.breakMultiplier=4:e<=40?C.breakMultiplier=5:e<=50?C.breakMultiplier=6:e<=60&&(C.breakMultiplier=7),C.breakTimerCustom=!0},review:function(){GenkiModal.open({title:"Activate Review Mode?",content:"Are you sure you want to review? Your current progress will be lost.",callback:function(){for(var e=L.querySelectorAll("[data-answer]"),t=0,i=e.length;t<i;t++)L.querySelector('[data-text="'+e[t].dataset.answer+'"]').appendChild(e[t]);C.timer.stop(),C.drake.destroy(),L.getElementById("quiz-timer").style.display="none",L.getElementById("review-exercise").innerHTML=(/\/dictionary\//.test(j.location)?C.lang.back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i>Restart</button>')+(L.querySelector(".drag-quiz")?C.lang.toggle_furigana+L.getElementById("toggle-orientation").outerHTML:""),L.getElementById("quiz-info").innerHTML='You are currently in review mode; go ahead and take your time to study. When you are ready to practice this exercise, click the "restart" button.',L.getElementById("quiz-zone").className+=" review-mode";var a=L.getElementById("change-exercise-type-container");a&&(a.style.display="none")}})},toHalfWidth:function(e){return e.replace(/[\uFF01-\uFF5E]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})},check:{busy:!1,value:function(e){var t;C.check.busy||e.value!=e.dataset.answer?C.check.busy&&j.setTimeout(function(){C.check.busy=!1,L.activeElement&&L.activeElement.value&&L.activeElement.value==C.input.map[C.input.index-1].value&&(L.activeElement.value="")},10):(C.check.busy=!0,(t=C.input.map[C.input.index+1])?t.focus():j.setTimeout(function(){e.blur(),C.check.answers(!0),C.check.busy=!1},10))},answers:function(e,d){C.exerciseComplete||GenkiModal.open({title:"Check Answers?",content:e?"The last input field has been filled in. Are you ready to check your answers?":"Checking your answers will end the quiz. Do you want to continue?",buttonText:"Yes, check my answers!",callback:function(){if(C.exerciseComplete=!0,L.querySelector("#check-answers button").style.display="none",d&&"drawing"==d)for(var e,t=0,i=(o=L.querySelectorAll(".kanji-canvas")).length;t<i;t++)e=KanjiCanvas.recognize(o[t].id),C.debug&&console.log("toDraw: "+o[t].dataset.kanji),C.debug&&console.log("Results: "+e),C.debug&&console.log("Correct: "+(new RegExp(o[t].dataset.kanji).test(e)&&o[t].dataset.strokesAnswer==o[t].dataset.strokes).toString()),new RegExp(o[t].dataset.kanji).test(e)&&o[t].dataset.strokesAnswer==o[t].dataset.strokes?o[t].dataset.answer=!0:(o[t].dataset.answer=!1,++C.stats.mistakes),++C.stats.solved;else for(var a,s,n,r,o,l,c=L.querySelectorAll("#exercise .writing-zone-input"),t=0,i=c.length;t<i;t++){for(a in s=!1,r=c[t].dataset,n=C.toHalfWidth(c[t].value).toLowerCase().replace(/。|、|^\s+|\s+$|\n/g,""),r)if(/answer/.test(a)){if(o=C.toHalfWidth(r[a]).toLowerCase().replace(/。|、|^\s+|\s+$|\n/g,""),/%\(.*?\)/.test(o))if(l=o.replace(/.*?%\((.*?)\).*/,"$1").split("/"),"answer"==a||"answer2"==a)for(;l.length;){if(n==o.replace(/%\(.*?\)/,l[0])){s=!0;break}l.splice(0,1)}else"answer3"!=a&&"answer4"!=a&&"answer5"!=a&&"answer6"!=a&&"answer7"!=a&&"answer8"!=a&&"answer9"!=a&&"answer10"!=a||-1==l.indexOf(n)||(s=!0);else n==o&&(s=!0);if(s)break}s?c[t].parentNode.className+=" answer-correct":(++r.mistakes,++C.stats.mistakes,"fill"==d&&c[t].parentNode.insertAdjacentHTML("beforeend",('<span class="problem-answer">'+r.answer+(r.answer2||r.furigana?'<span class="secondary-answer'+(r.furigana?" furigana-only":"")+'">'+(r.answer2||r.furigana)+"</span>":"")+"</span>").replace(/%\((.*?)\)/g,function(e,t){return'<span class="alt-phrase">(</span>'+t.replace(/\//g,'<span class="alt-phrase-sep">/</span>')+'<span class="alt-phrase">)</span>'}))),++C.stats.solved,c[t].disabled=!0}C.endQuiz(d||C.QuizType.WRITING)}})}},toggle:{exerciseList:function(e){e.className="list-open"==e.className?"":"list-open"},list:function(e){var t="lesson-title",i=t+" lesson-open";e.className=e.className==i?t:i;for(var a=e.parentNode.querySelectorAll(".lesson-title"),s=0,n=a.length;s<n;s++)a[s]!=e&&(a[s].className=t)},furigana:function(e){var t=L.getElementById("quiz-zone"),i=storageOK&&localStorage.furiganaVisible||(/helper-hidden/.test(t.className)?"false":"true");switch(i){case"true":i="false",t.className=t.className.replace("helper-present","helper-hidden"),e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":i="true",t.className=t.className.replace("helper-hidden","helper-present"),e.innerHTML=e.innerHTML.replace("Show","Hide")}C.lang.toggle_furigana=e.outerHTML,storageOK&&(localStorage.furiganaVisible=i)},vocabSpoiler:function(e){var t=e.nextSibling;/spoiler-off/.test(t.className)?(t.className=t.className.replace("spoiler-off",""),e.innerHTML=e.innerHTML.replace("Hide","Show")):(t.className+=" spoiler-off",e.innerHTML=e.innerHTML.replace("Show","Hide"))},vocabOrientation:function(e,t){var i=L.getElementById("quiz-zone"),a=void 0!==t?t:storageOK&&localStorage.vocabHorizontal||(/vocab-horizontal/.test(i.className)?"true":"false"),s=L.querySelectorAll(".quiz-answer-zone"),n=0,r=s.length;switch(a){case"true":a="false",i.className=i.className.replace(" vocab-horizontal",""),e.innerHTML=e.innerHTML.replace("Vertical","Horizontal"),e.querySelector("i").style.transform="rotate(90deg)";for(var o=L.getElementById("drop-list");n<r;n++)o.appendChild(s[n]);break;case"false":a="true",i.className+=" vocab-horizontal",e.innerHTML=e.innerHTML.replace("Horizontal","Vertical"),e.querySelector("i").style.transform="rotate(0deg)";for(var l=L.querySelectorAll(".quiz-item-group");n<r;n++)l[n].appendChild(s[n])}storageOK&&!t&&(localStorage.vocabHorizontal=a)},strokeNumbers:function(e){L.getElementById("quiz-zone");switch(C.strokeNumberDisplay){case!0:C.strokeNumberDisplay=!1,e.innerHTML=e.innerHTML.replace("Hide","Show");break;case!1:C.strokeNumberDisplay=!0,e.innerHTML=e.innerHTML.replace("Show","Hide")}for(var t=L.querySelectorAll(".kanji-canvas"),i=0,a=t.length;i<a;i++)KanjiCanvas["canvas_"+t[i].id]&&KanjiCanvas.redraw(t[i].id,!1,C.strokeNumberDisplay)},strokeOrder:function(e){var t=L.getElementById("quiz-zone"),i=storageOK&&localStorage.strokeOrderVisible||(/stroke-order-hidden/.test(t.className)?"false":"true");switch(i){case"true":i="false",t.className=t.className+=" stroke-order-hidden",e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":i="true",t.className=t.className.replace(" stroke-order-hidden",""),e.innerHTML=e.innerHTML.replace("Show","Hide")}storageOK&&(localStorage.strokeOrderVisible=i)},tracingGuide:function(e,t){L.getElementById("quiz-zone");var i=storageOK&&localStorage.tracingGuideVisible?localStorage.tracingGuideVisible:"true";switch(i){case"true":i="false",e.innerHTML=e.innerHTML.replace("Hide","Show");break;case"false":i="true",e.innerHTML=e.innerHTML.replace("Show","Hide")}var a=L.querySelectorAll(".kanji-canvas"),s=0,n=a.length;if(t)for(var r=0,o="";s<n;s++)a[s].dataset.kanji!=o&&(o=a[s].dataset.kanji,r=0),r++<3&&(a[s].dataset.guide=i,KanjiCanvas["canvas_"+a[s].id])&&KanjiCanvas.redraw(a[s].id,!0);else for(;s<n;s++)a[s].dataset.guide=i,KanjiCanvas["canvas_"+a[s].id]&&KanjiCanvas.redraw(a[s].id,!0);storageOK&&(localStorage.tracingGuideVisible=i)},textSelection:function(e){var t=L.getElementById("quiz-zone");switch(C.textSelectMode){case!0:C.textSelectMode=!1,t.className=t.className.replace(" text-selection-mode",""),e.innerHTML=e.innerHTML.replace("Dis","En");break;case!1:C.textSelectMode=!0,t.className=t.className+=" text-selection-mode",e.innerHTML=e.innerHTML.replace("En","Dis")}}},create:{exerciseButtons:function(){for(var e,t='<div class="more-exercises clear">',i=2;0<i--;)(e=C.exercises[1==i?C.active.index-1:C.active.index+1])&&!/^\.\.\//.test(e)&&(e=e.split("|"),t+='<a href="../../../'+C.ed+"/"+e[0]+"/"+C.local+C.debug+'" class="button '+(1==i?"prev":"next")+'-ex" title="'+(1==i?"Previous":"Next")+' exercise">'+e[1]+"</a>");L.getElementById("quiz-timer").insertAdjacentHTML("afterend",t+"</div>")},removeExerciseList:function(){var e=L.getElementById("exercise-list"),t=L.getElementById("toggle-exercises");e&&e.parentNode.removeChild(e),t&&t.parentNode.removeChild(t)},exerciseList:function(){var e='<div id="link-list" class="normal-block indent-block"><div><a id="link-home" class="button" href="'+getPaths()+(storageOK&&"3rd"==localStorage.GenkiEdition?"lessons-3rd/":"")+C.local+'"><i class="fa">&#xf015;</i>Home</a></div><div><a id="link-anki" href="'+getPaths()+"help/anki-decks/"+C.local+'"><i class="fa">&#xf005;</i>Anki Decks</a></div><div><a id="link-help" href="'+getPaths()+"help/"+C.local+'"><i class="fa">&#xf059;</i>Help &amp; FAQ</a></div><div><a id="link-report" href="'+getPaths()+"report/"+C.local+'"><i class="fa">&#xf188;</i>Reports &amp; Feedback</a></div><div><a id="link-download" href="'+getPaths()+"download/"+C.local+'"><i class="fa">&#xf019;</i>Download</a></div><div><a id="link-donate" href="'+getPaths()+"donate/"+C.local+'"><i class="fa">&#xf004;</i>Donate</a></div><div><a id="link-github" href="https://github.com/SethClydesdale/tobira-study-resources"><i class="fa">&#xf09b;</i>GitHub</a></div><div><a id="link-settings" href="#genki-site-settings" onclick="GenkiSettings.manager(); return false;"><i class="fa">&#xf013;</i>Settings</a></div></div><div id="related" class="indent-block"><h3>Related Projects</h3><a href="https://sethclydesdale.github.io/tobira-study-resources/" title="Tobira Study Resources"><img src="'+getPaths()+'resources/images/tobira-img.png" alt="Tobira Study Resources"></a><a href="https://sethclydesdale.github.io/colloquial-kansai-dictionary/" title="Colloquial Kansai Japanese"><img src="'+getPaths()+'resources/images/kansai-img.png" alt="Colloquial Kansai Japanese"></a></div>';if(C.exercises){var t,i='class="lesson-title" onclick="Genki.toggle.list(this);" onkeydown="event.key == \'Enter\' && Genki.toggle.list(this);" tabindex="0"',a='<nav id="exercise-list"><h3 class="main-title">Exercise List</h3><button id="random-exercise" class="button" onclick="Genki.randomExercise();" title="Random Exercise"><i class="fa">&#xf074;</i></button><div id="lessons-list"><h4 '+i+'>Page links</h4><ul id="page-links">'+e+"</ul>",s="\\.\\.\\/",n=0,r=C.exercises.length,o="",l=/workbook-\d+|literacy-\d+|literacy-wb-\d+/,c={workbook:"Workbook",literacy:"Reading and Writing","literacy-wb":"Workbook: Reading and Writing"};for(storageOK&&(localStorage.GenkiEdition=/lessons-3rd/.test(j.location.pathname)?"3rd":"2nd",localStorage.Results&&new RegExp(localStorage.GenkiEdition).test(localStorage.Results)||((u=localStorage.Results?JSON.parse(localStorage.Results):{})[localStorage.GenkiEdition]={},localStorage.Results=JSON.stringify(u)));n<r;n++){d=(t=C.exercises[n].split("|"))[0].replace(/^lesson-\d+\/|-\d+$/g,""),new RegExp(s).test(t[0])||(a+="</ul><h4 "+i+">"+(s=/^appendix/.test(t[0])?"appendix":/^study-tools/.test(t[0])?"study-tools":t[0].replace(/(lesson-\d+)\/.*/,"$1")).charAt(0).toUpperCase()+s.replace(/-/," ").slice(1)+'</h4><ul id="'+s+'">',o=""),l.test(t[0])&&o!=d&&(a+='<li><h4 class="sub-lesson-title">'+c[o=d]+"</h4></li>");var d=JSON.parse(localStorage.Results)[localStorage.GenkiEdition],d=d?parseInt(d[t[0]]):null,d=-1<d?(100==d?'<span class="exercise-results result--perfect" title="Exercise score"><i class="fa">&#xf005;</i> ':70<=d?'<span class="exercise-results result--good" title="Exercise score"><i class="fa">&#xf00c;</i> ':50<=d?'<span class="exercise-results result--average" title="Exercise score"><i class="fa">&#xf10c;</i> ':'<span class="exercise-results result--low" title="Exercise score"><i class="fa">&#xf00d;</i> ')+d+"%</span>":"";a+='<li class="menu-item-list"><a href="'+("\\.\\.\\/"==s?t[0]:"../../../"+C.ed+"/"+t[0]+"/")+C.local+C.debug+'" '+(t[2]?'data-page="Genki '+(+t[0].replace(/lesson-(\d+).*/,"$1")<13?"I":"II")+(/workbook-|wb-/.test(t[0])?" Workbook":"")+": "+t[2]+'"':"")+' title="'+t[1]+'">'+t[1]+"</a> "+d+"</li>"}L.getElementById("content").insertAdjacentHTML("afterbegin",'<a href="#toggle-exercises" id="toggle-exercises" onclick="Genki.toggle.exerciseList(this); return false;" title="Toggle exercise list"></a>'+a+"</ul></div></nav>"),C.active.exercise&&(C.toggle.list(L.getElementById(/^appendix/.test(C.active.exercise[0])?"appendix":/^study-tools/.test(C.active.exercise[0])?"study-tools":C.active.exercise[0].replace(/(lesson-\d+)\/.*/,"$1")).previousSibling),(u=L.querySelector('a[href*="'+C.active.exercise[0]+'"]')).className+=" active-lesson",u=u.parentNode,L.getElementById("lessons-list").scrollTop=u.offsetTop-(u.getBoundingClientRect().height+(j.matchMedia&&matchMedia("(pointer:coarse)").matches?0:6)))}else{var u='<a href="#toggle-navigation" id="toggle-exercises" onclick="Genki.toggle.exerciseList(this); return false;" title="Toggle quick navigation"></a><nav id="exercise-list"><h3 class="main-title">Quick Navigation</h3><div id="lessons-list">'+e+"</div></nav>";L.getElementById("content").insertAdjacentHTML("afterbegin",u)}},exerciseTypeButton:function(){var e=L.getElementById("quiz-timer"),t=L.createElement("DIV"),i=L.createElement("BUTTON");t.id="change-exercise-type-container",t.className="center",i.id="change-exercise-type",i.className="button",i.innerHTML='<i class="fa">&#xf021;</i> Change Exercise Type',i.onclick=function(){GenkiModal.open({title:"Change Exercise Type?",content:"To change the exercise type, you must quit the current exercise. Do you want to quit?",buttonText:"Quit",closeButtonText:"Cancel",keepOpen:!!(/\/dictionary\//.test(j.location)||!C.tools&&/"format"/.test(C.exerciseData)),callback:function(){if(/(?:begin|start)=\d/.test(j.location.search)){if(!j.history||!j.history.pushState)return void(j.location.search="");j.history.pushState({},L.title,j.location.href.replace(j.location.search,"")+C.debug)}C.changingExType=!0,C.reset()}})},t.appendChild(i),e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)}},parse:{image:function(e){var t=/^http/.test(e[1])?e[1]:"../../../resources/images/lesson-images/"+e[1];return'<a href="'+t+'" target="blank" title="View full image" class="lesson-image"><img src="'+t+'" alt="'+(e[2]||e[1])+'" /></a>'}},quickJisho:{hidden:!0,selectorHidden:!0,tabbing:!1,create:function(){var e,t,i,a;C.quickJisho.cache||(e=L.createElement("DIV"),t=L.createElement("DIV"),i=L.createElement("BUTTON"),a=L.createDocumentFragment(),e.id="quick-jisho-toggle",e.innerHTML='<i class="fa">&#xf02d;</i>',e.title="Toggle Quick Dictionary",e.tabIndex=0,e.onclick=C.quickJisho.toggle,e.onkeypress=function(e){"Enter"==e.key&&C.quickJisho.toggle()},t.id="quick-jisho-window",t.className="quick-jisho-hidden",t.innerHTML='<div class="quick-jisho-header"><h3 id="quick-jisho-title" class="main-title"> Quick Dictionary <span id="quick-jisho-hits"></span> </h3> <i class="fa fa-hover" onclick="Genki.quickJisho.toggle()">&#xf2d1;</i>  </div><div id="quick-jisho-content"><div class="quick-jisho-row center"><input tabindex="0" id="quick-jisho-search" type="text" placeholder="Search..." oninput="Genki.quickJisho.search(this.value);"></div><div class="quick-jisho-row"><ul id="quick-jisho-results"></ul></div></div>',i.id="quick-jisho-selector",i.className="button",i.style.display="none",i.innerHTML='<i class="fa">&#xf002;</i>Look up',i.onclick=C.quickJisho.lookUp,i.tabIndex=0,a.appendChild(t),a.appendChild(e),a.appendChild(i),L.body.appendChild(a),L.querySelector(".footer-right").style.marginRight="40px",C.quickJisho.cache={box:t,search:L.getElementById("quick-jisho-search"),results:L.getElementById("quick-jisho-results"),hits:L.getElementById("quick-jisho-hits"),selector:L.getElementById("quick-jisho-selector")},L.onselectionchange=C.quickJisho.getSelection,L.onmousemove=function(e){C.quickJisho.x=Math.abs(e.pageX-L.body.clientWidth)<100?e.pageX-95:e.pageX,C.quickJisho.y=Math.abs(e.pageY-L.body.clientHeight)<40?e.pageY-32:e.pageY+12},L.onkeydown=function(e){"Tab"!=e.key||C.quickJisho.selectorHidden||L.activeElement==C.quickJisho.cache.selector||(C.quickJisho.tabbing=!0,C.quickJisho.cache.selector.focus(),e.preventDefault())})},toggle:function(){var e;C.jisho||C.quickJisho.loading||(C.quickJisho.loading=!0,(e=L.createElement("SCRIPT")).src=getPaths()+"resources/javascript/jisho.min.js",e.onload=function(){C.quickJisho.cache.search.value&&C.quickJisho.search(C.quickJisho.cache.search.value),C.quickJisho.loading=!1},L.body.appendChild(e)),C.quickJisho.hidden?(C.quickJisho.cache.box.className="",C.quickJisho.hidden=!1,C.quickJisho.cache.search.focus()):(C.quickJisho.cache.box.className="quick-jisho-hidden",C.quickJisho.hidden=!0)},search:function(l,c){C.quickJisho.searchTimeout&&j.clearTimeout(C.quickJisho.searchTimeout),C.quickJisho.searchTimeout=j.setTimeout(function(){var e,t,i,a,s,n,r="",o=0;if(C.quickJisho.cache.results.innerHTML="",l)for(e in l=l.toLowerCase(),C.jisho)for(t=0,i=C.jisho[e].length;t<i;t++)for(a in C.jisho[e][t])if(-1!=C.jisho[e][t][a].toLowerCase().indexOf(l)){r+='<li tabindex="0" class="definition clear"><span class="def-ja'+((s=C.jisho[e][t].ja.split("|"))[1]?" def-furi":"")+'">'+s[0]+(s[1]?"<i>"+s[1]+"</i>":"")+'</span><span class="def-en">'+C.jisho[e][t].en+"</span>"+(C.jisho[e][t].v?' <span class="def-vtype">[<i>'+C.jisho[e][t].v+"</i>]</span>":"")+'<span class="def-label">'+C.jisho[e][t].l+"</span>",o++;break}!c&&!r&&l&&/[\u3400-\u9faf]/.test(l)?(n=l.match(/[\u3400-\u9faf]+/))&&n[0]&&C.quickJisho.search(n[0],!0):(C.quickJisho.cache.results.innerHTML=r||(l?'<li>No results found for "'+l+'".</li>':""),C.quickJisho.cache.hits.innerHTML=o?"("+o+")":""),delete C.quickJisho.searchTimeout},300)},lookUp:function(){C.quickJisho.hidden&&C.quickJisho.toggle(),C.quickJisho.cache.search.value="".trim?C.quickJisho.selectedText.trim():C.quickJisho.selectedText,C.quickJisho.search(C.quickJisho.cache.search.value),this.style.display="none",C.quickJisho.selectorHidden=!0},getSelection:function(){var e;return(!storageOK||"false"!=localStorage.genkiJishoLookUp)&&(C.quickJisho.tabbing?(C.quickJisho.tabbingOff||(C.quickJisho.tabbingOff=setTimeout(function(){C.quickJisho.tabbing=!1,delete C.quickJisho.tabbingOff},10)),!1):void(L.getSelection&&("Range"==(e=L.getSelection()).type&&e.toString&&!/quick-jisho/.test(e.focusNode.className)?(C.quickJisho.selectedText=e.toString(),C.quickJisho.cache.selector.style.left=C.quickJisho.x+"px",C.quickJisho.cache.selector.style.top=C.quickJisho.y+"px",C.quickJisho.selectorHidden&&(C.quickJisho.cache.selector.style.display="",C.quickJisho.selectorHidden=!1)):(C.quickJisho.selectedText="",C.quickJisho.selectorHidden||(C.quickJisho.cache.selector.style.display="none",C.quickJisho.selectorHidden=!0)))))}},playAudio:function(e,t){e=L.getElementById(e);e&&(e.currentTime=t,e.play())},viewStrokeOrder:function(e,t,i){t=getPaths()+"resources/images/stroke-order/"+t+".png";GenkiModal.open({title:e+" Stroke Order",content:'<div class="kanji-stroke-order center"><div class="big-kanji'+(i?" kana-font":"")+'"'+(/り/.test(e)?' style="font-family:SawarabiGothic, MS Gothic, Yu Gothic, NotoSansJP, Meiryo;"':"")+">"+e+'</div><a class="button-link" href="'+(i?getPaths()+"resources/images/stroke-order/sasagami-"+i+".jpg":"https://jisho.org/search/"+e+"%20%23kanji")+'" target="_blank" title="View stroke order '+(i?"chart":"on jisho.org")+'"><button class="button"><i class="fa">&#xf002;</i></button></a><a href="'+t+'" target="_blank" title="Click to view image"><img src="'+t+'" alt="stroke order"/></a></div>'})},getAlts:function(e,t,i){for(var a,s,n,r=t.split("|"),o=r.length,l=Math.pow(2,o),c=[],d=0;d<l;++d)a=0,n=e.replace(/\{(.*?)\}/g,function(e,t){return s=a++,1<<o-1-s&d?r[s]:t}),c.push(n);return C.debug&&(t=c.length,console[t/l*100==100?"log":"warn"](t+"/"+l+" ("+t/l*100+"% combo coverage for "+o+" replacements; "+(l-t)+" missing combos)",c)),i?c:"%("+c.join("/")+")|"},randomExercise:function(){if(storageOK&&"lesson"==localStorage.genkiRandomExercise&&/lesson-\d+/.test(j.location.href))var t=new RegExp(j.location.href.replace(/.*?(lesson-\d+).*/,"$1/")),e=C.exercises.filter(function(e){return t.test(e)});else if(storageOK&&"completed"==localStorage.genkiRandomExercise&&localStorage.Results&&JSON.parse(localStorage.Results)[localStorage.GenkiEdition]){var i=JSON.parse(localStorage.Results)[localStorage.GenkiEdition];if(!(e=C.exercises.filter(function(e){return e.split("|")[0]in i}))[0])return alert("Cannot select a random exercise, because you have not completed enough exercises yet.")}else e=C.exercises;e=e[Math.floor(Math.random()*e.length)].split("|");/lesson-\d+/.test(e[0])?j.location.href="../../../"+C.ed+"/"+e[0]+"/"+C.local+C.debug:C.randomExercise()},startOrPauseTimerByVisibility:function(){L.hidden&&C.timer.isRunning()?C.timer.pause():L.hidden||!C.timer.isPaused()||C.isTimerPausedByPopup||C.timer.start()},pauseTimerWhenOpenPopup:function(){C.timer.pause(),C.isTimerPausedByPopup=!0},startTimerWhenClosePopup:function(){C.timer.start(),C.isTimerPausedByPopup=!1},init:function(){if(C.exercises){for(var e,t=0,i=C.exercises.length,a=L.getElementById("quiz-result");t<i;t++)if(C.active.path==C.exercises[t].split("|")[0]){C.active.exercise=C.exercises[t]?C.exercises[t].split("|"):null,C.active.index=t;break}C.active.exercise?(e=/^appendix/.test(C.active.exercise[0])?"appendix":/^study-tools/.test(C.active.exercise[0])?"study-tools":+C.active.exercise[0].replace(/lesson-(\d+).*/,"$1"),a.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center" '+(C.active.exercise[2]?'data-page="Genki '+(e<13?"I":"II")+(/workbook-|wb-/.test(C.active.exercise[0])?" Workbook":"")+": "+C.active.exercise[2]+'"':"")+">"+("appendix"==e?"巻末":"study-tools"==e?"ツール":"第"+e+"課")+" - "+C.active.exercise[1]+"</h2>")):a.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center">'+L.querySelector("TITLE").innerText.replace(/\s\|.*/,"")+"</h2>"),C.isTouch&&(L.ontouchstart=function(){C.isTouching=!0},L.addEventListener("touchmove",function(e){C.isTouching&&/hidden/i.test(L.body.style.overflow)&&e.preventDefault()},{passive:!1}),L.ontouchend=function(){C.isTouching=!1},L.ontouchcancel=function(){C.isTouching=!1}),C.create.exerciseButtons()}C.create.exerciseList(),j.Genki=this}};j.onbeforeunload=function(){var e=!1,t=L.getElementById("exercise");if(t){if(t=t.className,/quiz-over/.test(t)||L.querySelector(".review-mode"))e=!1;else if(/fill-quiz|writing-quiz/.test(t)){for(var i=0,a=(s=L.querySelectorAll(".writing-zone-input")).length;i<a;i++)if(""!=s[i].value){e=!0;break}}else if(/drawing-quiz|stroke-quiz/.test(t)){for(var s,i=0,a=(s=L.querySelectorAll(".kanji-canvas")).length;i<a;i++)if(KanjiCanvas["recordedPattern_"+s[i].id].length){e=!0;break}}else/multi-quiz|drag-quiz|kana-quiz/.test(t)&&0<C.stats.solved&&(e=!0);if(e)return"Your progress will be lost. Do you want to continue?"}},C.init()}(window,document);